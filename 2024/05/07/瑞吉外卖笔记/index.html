<!DOCTYPE html><html lang="en" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>瑞吉外卖笔记 | Hexo</title><meta name="author" content="John Doe"><meta name="copyright" content="John Doe"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="瑞吉外卖关于MybatisPlus知识点(需补充)controller层用mp特点1.LQW写条件 2.LQW方法主要方法,eq等值,锁定,获取 &#x3D;&gt;12.新增菜品 3.order排序 list &#x3D;&gt;12新增菜品 4.servic执行 双表查询1,同时操作2张表需要事务注解@Transactional 2.第一步..保存xx00的基本信息到xxoo表中 3.获取缺少">
<meta property="og:type" content="article">
<meta property="og:title" content="瑞吉外卖笔记">
<meta property="og:url" content="http://example.com/2024/05/07/%E7%91%9E%E5%90%89%E5%A4%96%E5%8D%96%E7%AC%94%E8%AE%B0/index.html">
<meta property="og:site_name" content="Hexo">
<meta property="og:description" content="瑞吉外卖关于MybatisPlus知识点(需补充)controller层用mp特点1.LQW写条件 2.LQW方法主要方法,eq等值,锁定,获取 &#x3D;&gt;12.新增菜品 3.order排序 list &#x3D;&gt;12新增菜品 4.servic执行 双表查询1,同时操作2张表需要事务注解@Transactional 2.第一步..保存xx00的基本信息到xxoo表中 3.获取缺少">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://i.loli.net/2021/02/24/5O1day2nriDzjSu.png">
<meta property="article:published_time" content="2024-05-07T05:15:16.000Z">
<meta property="article:modified_time" content="2024-05-07T05:16:28.767Z">
<meta property="article:author" content="John Doe">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://i.loli.net/2021/02/24/5O1day2nriDzjSu.png"><link rel="shortcut icon" href="/img/favicon.png"><link rel="canonical" href="http://example.com/2024/05/07/%E7%91%9E%E5%90%89%E5%A4%96%E5%8D%96%E7%AC%94%E8%AE%B0/index.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css?v=4.13.0"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.5.1/css/all.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui@5.0.33/dist/fancybox/fancybox.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false},
  copy: {
    success: 'Copy Successful',
    error: 'Copy Error',
    noSupport: 'Browser Not Supported'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  dateSuffix: {
    just: 'Just now',
    min: 'minutes ago',
    hour: 'hours ago',
    day: 'days ago',
    month: 'months ago'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: undefined,
  infinitegrid: {
    js: 'https://cdn.jsdelivr.net/npm/@egjs/infinitegrid@4.11.1/dist/infinitegrid.min.js',
    buttonText: 'Load More'
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: false,
  },
  autoDarkmode: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: '瑞吉外卖笔记',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2024-05-07 14:16:28'
}</script><script>(win=>{
      win.saveToLocal = {
        set: (key, value, ttl) => {
          if (ttl === 0) return
          const now = Date.now()
          const expiry = now + ttl * 86400000
          const item = {
            value,
            expiry
          }
          localStorage.setItem(key, JSON.stringify(item))
        },
      
        get: key => {
          const itemStr = localStorage.getItem(key)
      
          if (!itemStr) {
            return undefined
          }
          const item = JSON.parse(itemStr)
          const now = Date.now()
      
          if (now > item.expiry) {
            localStorage.removeItem(key)
            return undefined
          }
          return item.value
        }
      }
    
      win.getScript = (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        script.onerror = reject
        script.onload = script.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          script.onload = script.onreadystatechange = null
          resolve()
        }

        Object.keys(attr).forEach(key => {
          script.setAttribute(key, attr[key])
        })

        document.head.appendChild(script)
      })
    
      win.getCSS = (url, id = false) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onerror = reject
        link.onload = link.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          link.onload = link.onreadystatechange = null
          resolve()
        }
        document.head.appendChild(link)
      })
    
      win.activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
        if (t === 'dark') activateDarkMode()
        else if (t === 'light') activateLightMode()
      
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
      const detectApple = () => {
        if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
          document.documentElement.classList.add('apple')
        }
      }
      detectApple()
    })(window)</script><meta name="generator" content="Hexo 7.2.0"></head><body><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="https://i.loli.net/2021/02/24/5O1day2nriDzjSu.png" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="sidebar-site-data site-data is-center"><a href="/archives/"><div class="headline">Articles</div><div class="length-num">2</div></a><a href="/tags/"><div class="headline">Tags</div><div class="length-num">0</div></a><a href="/categories/"><div class="headline">Categories</div><div class="length-num">0</div></a></div><hr class="custom-hr"/></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header"><nav id="nav"><span id="blog-info"><a href="/" title="Hexo"><span class="site-name">Hexo</span></a></span><div id="menus"><div id="toggle-menu"><a class="site-page" href="javascript:void(0);"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">瑞吉外卖笔记</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">Created</span><time class="post-meta-date-created" datetime="2024-05-07T05:15:16.000Z" title="Created 2024-05-07 14:15:16">2024-05-07</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">Updated</span><time class="post-meta-date-updated" datetime="2024-05-07T05:16:28.767Z" title="Updated 2024-05-07 14:16:28">2024-05-07</time></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="瑞吉外卖笔记"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">Post Views:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><h1 id="瑞吉外卖"><a href="#瑞吉外卖" class="headerlink" title="瑞吉外卖"></a>瑞吉外卖</h1><h2 id="关于MybatisPlus知识点-需补充"><a href="#关于MybatisPlus知识点-需补充" class="headerlink" title="关于MybatisPlus知识点(需补充)"></a>关于<a target="_blank" rel="noopener" href="https://b11et3un53m.feishu.cn/wiki/PsyawI04ei2FQykqfcPcmd7Dnsc">MybatisPlus</a>知识点(需补充)</h2><h3 id="controller层用mp特点"><a href="#controller层用mp特点" class="headerlink" title="controller层用mp特点"></a>controller层用mp特点</h3><p>1.LQW写条件</p>
<p>2.LQW方法主要方法,eq等值,锁定,获取 &#x3D;&gt;12.新增菜品</p>
<p>3.order排序</p>
<p>list &#x3D;&gt;12新增菜品</p>
<p>4.servic执行</p>
<h3 id="双表查询"><a href="#双表查询" class="headerlink" title="双表查询"></a>双表查询</h3><p>1,同时操作2张表需要事务注解@Transactional</p>
<p>2.<strong>第一步</strong>..保存xx00的基本信息到xxoo表中</p>
<p>3.获取缺少字段(口味对应的id,套餐对应的id等)</p>
<p>4.for循环添加或者stream流(<strong>一定要锁定字段</strong>(缺少字段))</p>
<p>5.**第二步,**可能为多条数据 xxooService.saveBatch(对应字段);</p>
<h3 id="分页查找特点"><a href="#分页查找特点" class="headerlink" title="分页查找特点&#x3D;&gt;"></a>分页查找特点&#x3D;&gt;</h3><p>1.new Page(参数导入)&#x3D;&gt;2,LQW条件&#x3D;&gt;3.排序 order&#x3D;&gt;4.封装&#x3D;&gt;5返回 (&#x3D;&#x3D;&#x3D;like(StringUtils.isNotEmpty(name), Employee::getName, name);&#x3D;&#x3D;&#x3D;)</p>
<h3 id="区分-用不用-RequestBody-PathVariable"><a href="#区分-用不用-RequestBody-PathVariable" class="headerlink" title="区分 用不用 @RequestBody  @PathVariable"></a>区分 用不用 @RequestBody  @PathVariable</h3><p>用PathVariable是因为url用了占位符（”&#x2F;{id}”）所以加@PathVariable，而deleteMapping<strong>不要用占位符</strong></p>
<p>@RequestBody  请求体的内容（JSON、XML 等）映射到一个对象上。</p>
<p>@RequestParam  注解用于从 HTTP 请求的查询参数中获取数据，即 URL 中的参数部分。它常用于处理 GET 请求中的查询参数，也可以用于 POST 请求中的表单数据。</p>
<h3 id="分页不显示字段修改-13-2套餐分类-范例"><a href="#分页不显示字段修改-13-2套餐分类-范例" class="headerlink" title="分页不显示字段修改(13.2套餐分类) 范例"></a>分页不显示字段修改(13.2套餐分类) 范例</h3><p>1.构造一个普通的分页查询 &#x3D;&gt;Page<Setmeal> setmealPage &#x3D; new Page&lt;&gt;(page, pageSize);</p>
<p>2.插入dto &#x3D;&gt;Page<SetmealDto> setmealDtoPage &#x3D; new Page&lt;&gt;(page, pageSize);</p>
<p>3.复制 普通 &lt;页面&gt; 属性, 除 records字段 &#x3D;&gt;ueryWrapper.like(StringUtils.isNotEmpty(name), Setmeal::getName, name);</p>
<p>4.单独获取 records字段(1,2需要改成对应文字) &#x3D;&gt;List<Setmeal> records &#x3D; setmealPage.getRecords();</p>
<p>5.遍历records字段</p>
<p>5.1new一个新的dto </p>
<p>5.2复制item,到dto -为其他属性赋值 </p>
<p>5.3获取公共字段id(categoryId等) &#x3D;&gt; Long categoryId &#x3D; item.getCategoryId();</p>
<p>​														&#x3D;&gt;Category category &#x3D; categoryService.getById(categoryId);</p>
<p>5.4 if 非空 后 get set 后returen dto </p>
<p>5.5 .collect(Collectors.toList());</p>
<p>6.XXXOOODtoPage.setRecords(list);</p>
<p>7.return R.success(setmealDtoPage);</p>
<h5 id="删除-批量-总结"><a href="#删除-批量-总结" class="headerlink" title="删除(批量)总结"></a>删除(批量)总结</h5><p>双表记得加事务</p>
<p>1.split 分割    &#x3D;&gt;    String[] split &#x3D; ids.split(“,”);</p>
<p>可用  public R<String> delete(@RequestParam List<Long> ids) 代替</p>
<p>2.遍历 &#x3D;&gt; 判断停售 &#x3D;&gt; 本类删除 &#x3D;&gt;  setmealService.removeById(setmealId);</p>
<p>3.LQW条件eq锁定对应表的公共字段  &#x3D;&gt;  ….eq(SetmealDish::getSetmealId, setmealId);</p>
<p>4,删除 对应表的数据     &#x3D;&gt;         OOOXXXService.remove(queryWrapper);</p>
<p>5.返回 (可无)</p>
<h5 id="起售停售总结"><a href="#起售停售总结" class="headerlink" title="起售停售总结"></a>起售停售总结</h5><p>1.@PostMapping(“&#x2F;status&#x2F;{status}”)参数设置</p>
<p>2.public R<String> update(@PathVariable int status, @RequestParam List<Long> ids)或者 public R<String> update(@PathVariable int status, String ids) {</p>
<p>3.获得ids对应的对应的表格(套餐,菜品等)</p>
<p>4.设置 表格(套餐) setmeal.status字段为 指定 status(1,起售,0停售)</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Setmeal</span> <span class="variable">setmeal</span> <span class="operator">=</span> setmealService.getById(id);</span><br><span class="line">setmeal.setStatus(status);</span><br></pre></td></tr></table></figure>

<p>5.更新,返回</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">setmealService.updateById(setmeal);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> R.success(<span class="string">&quot;修改成功&quot;</span>);</span><br></pre></td></tr></table></figure>

<h6 id="验证码"><a href="#验证码" class="headerlink" title="验证码"></a>验证码</h6><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">String</span> <span class="variable">code</span> <span class="operator">=</span> ValidateCodeUtils.generateValidateCode(<span class="number">4</span>).toString();</span><br></pre></td></tr></table></figure>

<h4 id="获取用户idapi"><a href="#获取用户idapi" class="headerlink" title="获取用户idapi"></a>获取用户idapi</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//设置用户id,指定当前哪个用户的购物车</span></span><br><span class="line"><span class="type">Long</span> <span class="variable">currentId</span> <span class="operator">=</span> BaseContext.getCurrentId();</span><br></pre></td></tr></table></figure>

<h4 id="参数的接收"><a href="#参数的接收" class="headerlink" title="参数的接收"></a>参数的接收</h4><img src="assets/Snipaste_2024-05-06_18-46-35-1715058981801-1.png" style="zoom:200%;" />

<ol start="17">
<li>所以用orders接收</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@PostMapping(&quot;/submit&quot;)</span></span><br><span class="line"><span class="keyword">public</span> R&lt;String&gt; <span class="title function_">submit</span><span class="params">(<span class="meta">@RequestBody</span> Orders orders)</span> &#123;</span><br><span class="line">    略...</span><br></pre></td></tr></table></figure>

<h3 id="下订单-梳理逻辑"><a href="#下订单-梳理逻辑" class="headerlink" title="下订单-梳理逻辑"></a>下订单-梳理逻辑</h3><p>1获得当前用户id<br>2查询当前用户的购物车数握<br>3向订单表插入数据，一条数揭<br>4向订单明细表插入数据，多条数据<br>5清空鸭物车数</p>
<p>原子整形,17章,下单总和用到,多线程安全</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">AtomicInteger amount = new AtomicInteger(0)</span><br></pre></td></tr></table></figure>

<h2 id="1-整体介绍"><a href="#1-整体介绍" class="headerlink" title="1.整体介绍"></a>1.整体介绍</h2><p><img src="/assets/Snipaste_2024-04-29_18-55-16-1715058981802-2.png"></p>
<h3 id="1-1-功能架构"><a href="#1-1-功能架构" class="headerlink" title="1.1 功能架构"></a>1.1 功能架构</h3><p><img src="/assets/Snipaste_2024-04-29_18-56-50-1715058981802-3.png"></p>
<h3 id="1-2-角色"><a href="#1-2-角色" class="headerlink" title="1.2 角色"></a>1.2 角色</h3><ol>
<li>后台系统管理员：登录后台管理系统，拥有后台系统中的所有操作权限</li>
<li>后台系统着通员工：登录后台管理系统，对菜品、套餐、订单等进行管理</li>
<li>C端用户：登录移动端应用，可以浏览菜品、添加购物车、设置地址、在线下单等</li>
</ol>
<h2 id="2-开发环境的搭建"><a href="#2-开发环境的搭建" class="headerlink" title="2.开发环境的搭建"></a>2.开发环境的搭建</h2><h3 id="2-1-数据库"><a href="#2-1-数据库" class="headerlink" title="2.1 数据库"></a>2.1 数据库</h3><p><img src="/assets/Snipaste_2024-04-29_19-00-57-1715058981803-4.png"></p>
<h3 id="2-2-maven搭建"><a href="#2-2-maven搭建" class="headerlink" title="2.2 maven搭建"></a>2.2 maven搭建</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">project</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">modelVersion</span>&gt;</span>4.0.0<span class="tag">&lt;/<span class="name">modelVersion</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">parent</span>&gt;</span></span><br><span class="line"></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-parent<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.7.3<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!--  lookup parent from repository  --&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">parent</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>cn.itcast<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>reggie-take-out<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">maven.compiler.source</span>&gt;</span>11<span class="tag">&lt;/<span class="name">maven.compiler.source</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">maven.compiler.target</span>&gt;</span>11<span class="tag">&lt;/<span class="name">maven.compiler.target</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">project.build.sourceEncoding</span>&gt;</span>UTF-8<span class="tag">&lt;/<span class="name">project.build.sourceEncoding</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-test<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">scope</span>&gt;</span>compile<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.baomidou<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis-plus-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.4.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.projectlombok<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>lombok<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.18.20<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>fastjson<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.2.76<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>commons-lang<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>commons-lang<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.6<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>mysql<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mysql-connector-java<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">scope</span>&gt;</span>runtime<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>druid-spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.1.23<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></span><br></pre></td></tr></table></figure>



<h3 id="2-3-配置文件"><a href="#2-3-配置文件" class="headerlink" title="2.3 配置文件"></a>2.3 配置文件</h3><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">8080</span></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">application:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">reggie_take_out</span></span><br><span class="line">  <span class="attr">datasource:</span></span><br><span class="line">    <span class="attr">druid:</span></span><br><span class="line">      <span class="attr">driver-class-name:</span> <span class="string">com.mysql.cj.jdbc.Driver</span></span><br><span class="line">      <span class="attr">url:</span> <span class="string">jdbc:mysql://localhost:3306/reggie?serverTimezone=Asia/Shanghai&amp;useUnicode=true&amp;characterEncoding=utf-8&amp;zeroDateTimeBehavior=convertToNull&amp;useSSL=false&amp;allowPublicKeyRetrieval=true</span></span><br><span class="line">      <span class="attr">username:</span> <span class="string">root</span></span><br><span class="line">      <span class="attr">password:</span> <span class="string">ma</span></span><br><span class="line"><span class="attr">mybatis-plus:</span></span><br><span class="line">  <span class="attr">configuration:</span></span><br><span class="line">    <span class="comment">#在映射实体或者属性时，将数据库中表名和字段名中的下划线去掉，按照驼峰命名法映射</span></span><br><span class="line">    <span class="attr">map-underscore-to-camel-case:</span> <span class="literal">true</span></span><br><span class="line">    <span class="attr">log-impl:</span> <span class="string">org.apache.ibatis.logging.stdout.StdOutImpl</span></span><br><span class="line">  <span class="attr">global-config:</span></span><br><span class="line">    <span class="attr">db-config:</span></span><br><span class="line">      <span class="attr">id-type:</span> <span class="string">ASSIGN_ID</span></span><br></pre></td></tr></table></figure>



<h2 id="3-启动项"><a href="#3-启动项" class="headerlink" title="3 启动项"></a>3 启动项</h2><h3 id="3-1启动项"><a href="#3-1启动项" class="headerlink" title="3.1启动项"></a>3.1启动项</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ReggieApplication</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        SpringApplication.run(ReggieApplication.class,args);</span><br><span class="line">        log.info(<span class="string">&quot;启动项成功&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="3-2实体类导入"><a href="#3-2实体类导入" class="headerlink" title="3.2实体类导入"></a>3.2实体类导入</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Employee</span> <span class="keyword">implements</span> <span class="title class_">Serializable</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">long</span> <span class="variable">serialVersionUID</span> <span class="operator">=</span> <span class="number">1L</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Long id;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String username;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String password;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String phone;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String sex;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String idNumber;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Integer status;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> LocalDateTime createTime;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> LocalDateTime updateTime;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@TableField(fill = FieldFill.INSERT)</span></span><br><span class="line">    <span class="keyword">private</span> Long createUser;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@TableField(fill = FieldFill.INSERT_UPDATE)</span></span><br><span class="line">    <span class="keyword">private</span> Long updateUser;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>3.3 csm创建</p>
<p><img src="/assets/Snipaste_2024-04-29_19-12-09-1715058981803-5.png"></p>
<h3 id="3-3-通用的开发实体类"><a href="#3-3-通用的开发实体类" class="headerlink" title="3.3 通用的开发实体类"></a>3.3 通用的开发实体类</h3><p>代码开发<br>导入返回结果类R<br>此类是一个通用结果类，服务端响应的所有结果最终都会包装成此种类型返回给前端页面</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">R</span>&lt;T&gt; &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Integer code; <span class="comment">//编码：1成功，0和其它数字为失败</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String msg; <span class="comment">//错误信息</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> T data; <span class="comment">//数据</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="type">Map</span> <span class="variable">map</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">HashMap</span>(); <span class="comment">//动态数据</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> &lt;T&gt; R&lt;T&gt; <span class="title function_">success</span><span class="params">(T object)</span> &#123;</span><br><span class="line">        R&lt;T&gt; r = <span class="keyword">new</span> <span class="title class_">R</span>&lt;T&gt;();</span><br><span class="line">        r.data = object;</span><br><span class="line">        r.code = <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">return</span> r;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> &lt;T&gt; R&lt;T&gt; <span class="title function_">error</span><span class="params">(String msg)</span> &#123;</span><br><span class="line">        <span class="type">R</span> <span class="variable">r</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">R</span>();</span><br><span class="line">        r.msg = msg;</span><br><span class="line">        r.code = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">return</span> r;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> R&lt;T&gt; <span class="title function_">add</span><span class="params">(String key, Object value)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.map.put(key, value);</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">this</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="3-4映射-陌生"><a href="#3-4映射-陌生" class="headerlink" title="3.4映射(陌生)"></a>3.4映射(陌生)</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">WebMvcConfig</span> <span class="keyword">extends</span> <span class="title class_">WebMvcConfigurationSupport</span> &#123;</span><br><span class="line"></span><br><span class="line"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">addResourceHandlers</span><span class="params">(ResourceHandlerRegistry registry)</span>&#123;</span><br><span class="line">    log.info(<span class="string">&quot;开始进行静态资源映射&quot;</span>);</span><br><span class="line">    registry.addResourceHandler(<span class="string">&quot;/backend/**&quot;</span>).addResourceLocations(<span class="string">&quot;classpath:/backend/&quot;</span>);</span><br><span class="line">    registry.addResourceHandler(<span class="string">&quot;/front/**&quot;</span>).addResourceLocations(<span class="string">&quot;classpath:/front/&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>





<h2 id="4-登陆功能-陌生"><a href="#4-登陆功能-陌生" class="headerlink" title="4.登陆功能(陌生)"></a>4.登陆功能(陌生)</h2><h3 id="思路分析"><a href="#思路分析" class="headerlink" title="思路分析"></a>思路分析</h3><p><img src="/assets/Snipaste_2024-04-29_18-53-41-1715058981803-6.png" alt="Snipaste_2024-04-29_18-53-41"></p>
<h3 id="过滤器-代码实现-陌生"><a href="#过滤器-代码实现-陌生" class="headerlink" title="过滤器 - - 代码实现(陌生)"></a>过滤器 - - 代码实现(陌生)</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/employee&quot;)</span></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">EmployeeController</span> &#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> EmployeeService employeeService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@PostMapping(&quot;/login&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> R&lt;Employee&gt; <span class="title function_">login</span><span class="params">(HttpServletRequest request, <span class="meta">@RequestBody</span> Employee employee)</span> &#123;</span><br><span class="line">        <span class="comment">//将页码代码密码password 进行 md加密处理</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">password</span> <span class="operator">=</span> employee.getPassword();</span><br><span class="line">        password = DigestUtils.md5DigestAsHex(password.getBytes());</span><br><span class="line">        <span class="comment">//根据提交的用户username查询数据库</span></span><br><span class="line">        LambdaQueryWrapper&lt;Employee&gt; queryWrapper = <span class="keyword">new</span> <span class="title class_">LambdaQueryWrapper</span>&lt;&gt;();</span><br><span class="line">        queryWrapper.eq(Employee::getUsername, employee.getUsername());</span><br><span class="line">        <span class="type">Employee</span> <span class="variable">emp</span> <span class="operator">=</span> employeeService.getOne(queryWrapper);</span><br><span class="line">        <span class="comment">//如果没有查到,返回失败结果</span></span><br><span class="line">        <span class="keyword">if</span> (emp == <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> R.error(<span class="string">&quot;登陆失败&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//密码比对,如果不一致,登陆失败</span></span><br><span class="line">        <span class="keyword">if</span> (!emp.getPassword().equals(password)) &#123;</span><br><span class="line">            <span class="keyword">return</span> R.error(<span class="string">&quot;登陆密码不一致&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//查看员工状态是否正确</span></span><br><span class="line">        <span class="keyword">if</span> (emp.getStatus() == <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> R.error(<span class="string">&quot;员工已禁用&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//登陆成功,将员工id存入session并返回</span></span><br><span class="line">        request.getSession().setAttribute(<span class="string">&quot;employee&quot;</span>, emp.getId());</span><br><span class="line">        <span class="keyword">return</span> R.success(emp);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>





<h2 id="5-退出功能-陌生"><a href="#5-退出功能-陌生" class="headerlink" title="5 .退出功能(陌生)"></a>5 .退出功能(陌生)</h2><p>后台退出功能开发<br>代码开发<br>用户点击页面中退出按钮，发送请求，请求地址为&#x2F;employee&#x2F;logout,请求方式为POST。<br>我们只需要在Controller中创建对应的处理方法即可，具体的处理逻辑：<br>1、清理Session中的用户id<br>2、返回结果</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@PostMapping(&quot;/logout&quot;)</span></span><br><span class="line"><span class="keyword">public</span> R&lt;String&gt; <span class="title function_">logout</span><span class="params">(HttpServletRequest request)</span> &#123;</span><br><span class="line">    request.getSession().removeAttribute(<span class="string">&quot;employee&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> R.success(<span class="string">&quot;退出成功&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>





<h2 id="6-完善登陆功能-过滤器-陌生"><a href="#6-完善登陆功能-过滤器-陌生" class="headerlink" title="6. 完善登陆功能-过滤器(陌生)"></a>6. 完善登陆功能-过滤器(陌生)</h2><h3 id="6-1-先搭建架子-保证过滤器能生效"><a href="#6-1-先搭建架子-保证过滤器能生效" class="headerlink" title="6.1 先搭建架子-保证过滤器能生效"></a>6.1 先搭建架子-保证过滤器能生效</h3><p><img src="/assets/Snipaste_2024-04-29_18-23-35-1715058981803-7.png" alt="Snipaste_2024-04-29_18-23-35"></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//检查用户是否完成登陆</span></span><br><span class="line"><span class="meta">@WebFilter(filterName = &quot;loginCheckFilter&quot;, urlPatterns = &quot;/*&quot;)</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LoginCheckFilter</span> <span class="keyword">implements</span> <span class="title class_">Filter</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">doFilter</span><span class="params">(ServletRequest servletRequest, ServletResponse servletResponse, FilterChain filterChain)</span> <span class="keyword">throws</span> IOException, ServletException &#123;</span><br><span class="line">        <span class="type">HttpServletRequest</span> <span class="variable">request</span> <span class="operator">=</span> (HttpServletRequest) servletRequest;</span><br><span class="line">        <span class="type">HttpServletResponse</span> <span class="variable">response</span> <span class="operator">=</span> (HttpServletResponse) servletResponse;</span><br><span class="line">        log.info(<span class="string">&quot;拦截到请求:&#123;&#125;&quot;</span>, request);</span><br><span class="line">        filterChain.doFilter(request, response</span><br></pre></td></tr></table></figure>

<p>启动项 加入 @ServletComponentScan 扫描 @WebFilter</p>
<h3 id="6-2逻辑处理-陌生"><a href="#6-2逻辑处理-陌生" class="headerlink" title="6.2逻辑处理(陌生)"></a>6.2逻辑处理(陌生)</h3><p><img src="/assets/Snipaste_2024-04-29_20-22-59-1715058981803-8.png"></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//路径匹配器,支持通配符</span></span><br><span class="line"> <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">AntPathMatcher</span> <span class="variable">PATH_MATCHER</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">AntPathMatcher</span>();</span><br><span class="line"><span class="comment">//对比是否一致</span></span><br><span class="line"> <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">check</span><span class="params">(String[] urls, String requestURI)</span> &#123;</span><br><span class="line">        <span class="keyword">for</span> (String url : urls) &#123;</span><br><span class="line">            <span class="type">boolean</span> <span class="variable">match</span> <span class="operator">=</span> PATH_MATCHER.match(url, requestURI);</span><br><span class="line">            <span class="keyword">if</span> (match) &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p>完整代码</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//检查用户是否完成登陆</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@WebFilter(filterName = &quot;loginCheckFilter&quot;, urlPatterns = &quot;/*&quot;)</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LoginCheckFilter</span> <span class="keyword">implements</span> <span class="title class_">Filter</span> &#123;</span><br><span class="line">    <span class="comment">//路径匹配器,支持通配符</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">AntPathMatcher</span> <span class="variable">PATH_MATCHER</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">AntPathMatcher</span>();</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">doFilter</span><span class="params">(ServletRequest servletRequest, ServletResponse servletResponse, FilterChain filterChain)</span> <span class="keyword">throws</span> IOException, ServletException &#123;</span><br><span class="line">        <span class="type">HttpServletRequest</span> <span class="variable">request</span> <span class="operator">=</span> (HttpServletRequest) servletRequest;</span><br><span class="line">        <span class="type">HttpServletResponse</span> <span class="variable">response</span> <span class="operator">=</span> (HttpServletResponse) servletResponse;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//过滤器具体的处理逻辑如下：</span></span><br><span class="line">        <span class="comment">//1、获取本次请求的URI</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">requestURI</span> <span class="operator">=</span> request.getRequestURI();</span><br><span class="line">        String[] urls = <span class="keyword">new</span> <span class="title class_">String</span>[]&#123;<span class="string">&quot; /employee/login&quot;</span>, <span class="string">&quot; /employee/logout&quot;</span>, <span class="string">&quot;/backend/**&quot;</span>, <span class="string">&quot; /front/**&quot;</span>&#125;;</span><br><span class="line">        <span class="comment">//2、判断本次请求是否需要处理</span></span><br><span class="line">        <span class="type">boolean</span> <span class="variable">check</span> <span class="operator">=</span> check(urls, requestURI);</span><br><span class="line">        <span class="comment">//3、如果不需要处理，则直接放行</span></span><br><span class="line">        <span class="keyword">if</span> (check) &#123;</span><br><span class="line">            filterChain.doFilter(request, response);</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//4、判断登录状态，如果已登录，则直接放行</span></span><br><span class="line">        <span class="keyword">if</span> (request.getSession().getAttribute(<span class="string">&quot;employee&quot;</span>) != <span class="literal">null</span>) &#123;</span><br><span class="line">            filterChain.doFilter(request, response);</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//5、如果未登录则返回未登录结果</span></span><br><span class="line">        <span class="comment">//当访问index页面，过滤器会放行，</span></span><br><span class="line">        <span class="comment">// 但前端拦截器判断登录状态，没登录则跳转login页面，这就会导致页面闪频</span></span><br><span class="line">        response.getWriter().write(JSON.toJSONString(R.error(<span class="string">&quot;NOTLOGIN&quot;</span>)));</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">check</span><span class="params">(String[] urls, String requestURI)</span> &#123;</span><br><span class="line">        <span class="keyword">for</span> (String url : urls) &#123;</span><br><span class="line">            <span class="type">boolean</span> <span class="variable">match</span> <span class="operator">=</span> PATH_MATCHER.match(url, requestURI);</span><br><span class="line">            <span class="keyword">if</span> (match) &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="7-新增员工"><a href="#7-新增员工" class="headerlink" title="7.新增员工"></a>7.新增员工</h2><h3 id="7-1需求分析和数据模型"><a href="#7-1需求分析和数据模型" class="headerlink" title="7.1需求分析和数据模型"></a>7.1需求分析和数据模型</h3><p><img src="D:\OneDrive\assets\Snipaste_2024-04-29_22-52-58.png"></p>
<p>导入员工类</p>
<h3 id="7-2梳理流程"><a href="#7-2梳理流程" class="headerlink" title="7.2梳理流程*"></a>7.2梳理流程*</h3><p><img src="D:\OneDrive\assets\Snipaste_2024-04-29_22-57-01.png"></p>
<h3 id="7-3代码实现"><a href="#7-3代码实现" class="headerlink" title="7.3代码实现"></a>7.3代码实现</h3><p>完整代码</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//员工登陆\</span></span><br><span class="line"><span class="meta">@PostMapping</span></span><br><span class="line"><span class="keyword">public</span> R&lt;String&gt; <span class="title function_">save</span> <span class="params">(HttpServletRequest request,<span class="meta">@RequestBody</span> Employee employee)</span>&#123;</span><br><span class="line">    log.info(<span class="string">&quot;新增员工,员工信息:&#123;&#125;&quot;</span>,employee);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//设置初始密码123456,需进行md5加密处理</span></span><br><span class="line">    employee.setPassword(DigestUtils.md5DigestAsHex(<span class="string">&quot;123456&quot;</span>.getBytes()));</span><br><span class="line"></span><br><span class="line">    employee.setCreateTime(LocalDateTime.now());</span><br><span class="line">    employee.setUpdateTime(LocalDateTime.now());</span><br><span class="line">    <span class="comment">//获取当前登陆用户的id</span></span><br><span class="line">    employee.setCreateUser((Long) request.getSession().getAttribute(<span class="string">&quot;employee&quot;</span>));</span><br><span class="line">    employee.setUpdateUser((Long) request.getSession().getAttribute(<span class="string">&quot;employee&quot;</span>));</span><br><span class="line"></span><br><span class="line">    employeeService.save(employee);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> R.success(<span class="string">&quot;新增员工成功&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><u>此时有异常 重名不可新增</u></p>
<h3 id="7-4编写全局异常处理器-重名不可新增-陌生"><a href="#7-4编写全局异常处理器-重名不可新增-陌生" class="headerlink" title="7.4编写全局异常处理器-重名不可新增(陌生)"></a>7.4编写全局异常处理器-重名不可新增(陌生)</h3><p><img src="D:\OneDrive\assets\Snipaste_2024-04-29_23-43-48.png"></p>
<p>选择第2类,全局异常捕获可复用</p>
<h4 id="代码实现"><a href="#代码实现" class="headerlink" title="代码实现"></a>代码实现</h4><p>在common下创建 GlobalExceptionHandler类</p>
<h4 id="找错错误并返回-陌生"><a href="#找错错误并返回-陌生" class="headerlink" title="找错错误并返回(陌生)"></a>找错错误并返回(陌生)</h4><p><u>注意   return R.error(msg);</u></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (ex.getMessage().contains(<span class="string">&quot;Duplicate entry&quot;</span>)) &#123;</span><br><span class="line">    String[] split = ex.getMessage().split(<span class="string">&quot; &quot;</span>);</span><br><span class="line">    <span class="type">String</span> <span class="variable">msg</span> <span class="operator">=</span> split[<span class="number">2</span>] + <span class="string">&quot;已存在&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span>     R.error(msg);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>完整代码</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//全局异常处理</span></span><br><span class="line"><span class="meta">@ControllerAdvice(annotations = &#123;RestController.class, Controller.class&#125;)</span></span><br><span class="line"><span class="meta">@ResponseBody</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">GlobalExceptionHandler</span> &#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">//异常处理方法</span></span><br><span class="line">    <span class="meta">@ExceptionHandler(SQLIntegrityConstraintViolationException.class)</span></span><br><span class="line">    <span class="keyword">public</span> R&lt;String&gt; <span class="title function_">exceptionHandler</span><span class="params">(SQLIntegrityConstraintViolationException ex)</span> &#123;</span><br><span class="line">        log.error(ex.getMessage());</span><br><span class="line">        <span class="keyword">if</span> (ex.getMessage().contains(<span class="string">&quot;Duplicate entry&quot;</span>)) &#123;</span><br><span class="line">            String[] split = ex.getMessage().split(<span class="string">&quot; &quot;</span>);</span><br><span class="line">            <span class="type">String</span> <span class="variable">msg</span> <span class="operator">=</span> split[<span class="number">2</span>] + <span class="string">&quot;已存在&quot;</span>;</span><br><span class="line">            <span class="keyword">return</span> R.error(msg);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> R.error(<span class="string">&quot;未知错误&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h3 id="总结-重点复习"><a href="#总结-重点复习" class="headerlink" title="总结 (重点复习)"></a>总结 (重点复习)</h3><p>1、根据产品原型明确业务需求<br>2、重点分析数据的流转过程和数据格式<br>3、通过debug断点调试跟踪程序执行过程</p>
<p><img src="/assets/Snipaste_2024-04-30_10-38-13-1715058981803-9.png"></p>
<h2 id="8-员工信息的分页查询"><a href="#8-员工信息的分页查询" class="headerlink" title="8.员工信息的分页查询"></a>8.员工信息的分页查询</h2><h3 id="8-1需求分析"><a href="#8-1需求分析" class="headerlink" title="8.1需求分析"></a>8.1需求分析</h3><p><img src="/assets/Snipaste_2024-04-30_10-40-04-1715058981803-10.png"></p>
<p>注意,有查询条件需要过滤</p>
<h3 id="8-2过程梳理"><a href="#8-2过程梳理" class="headerlink" title="8.2过程梳理"></a>8.2过程梳理</h3><p>需要粗略了解前端流程</p>
<p><img src="/assets/Snipaste_2024-04-30_10-43-48-1715058981803-11.png"></p>
<h3 id="8-3代码开发"><a href="#8-3代码开发" class="headerlink" title="8.3代码开发"></a>8.3代码开发</h3><h4 id="创建MybatisPlusConfig-陌生"><a href="#创建MybatisPlusConfig-陌生" class="headerlink" title="创建MybatisPlusConfig(陌生)"></a>创建MybatisPlusConfig(陌生)</h4><p>是用于配置Mybatis-Plus的。Mybatis-Plus是一个Mybatis的增强工具，提供了更便捷的API来处理数据库操作。这段代码的主要作用是创建一个MybatisPlusInterceptor实例，并添加一个分页拦截器。</p>
<ol>
<li><p><code>@Configuration</code>：这是一个Java注解，表示这是一个配置类。配置类会在Spring框架中自动创建Bean，以便在其他地方使用。</p>
</li>
<li><p><code>mybatisPlusInterceptor()</code>：这是一个方法，返回一个MybatisPlusInterceptor实例。这个方法会被Spring框架自动扫描到，并将其创建为一个Bean。</p>
</li>
<li><p><code>new MybatisPlusInterceptor()</code>：创建一个MybatisPlusInterceptor实例。这个类包含了一些拦截器，用于处理数据库操作。</p>
</li>
<li><p><code>addInnerInterceptor(new PaginationInnerInterceptor())</code>：向MybatisPlusInterceptor中添加一个分页拦截器。分页拦截器用于处理分页查询，确保查询结果中包含分页信息。</p>
</li>
</ol>
<p>实现原理：Mybatis-Plus是一个增强工具，它提供了更多的方法来简化数据库操作。这段代码的作用是配置Mybatis-Plus，使其在项目中更易用。</p>
<p>用途：在项目中使用Mybatis-Plus，可以提高数据库操作的效率和代码的可维护性。</p>
<p>注意事项：配置类中只能包含静态方法和Bean，不能包含类成员变量和方法覆盖。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MybatisPlusConfig</span> &#123;</span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> MybatisPlusInterceptor <span class="title function_">mybatisPlusInterceptor</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">// 创建MybatisPlusInterceptor实例</span></span><br><span class="line">        <span class="type">MybatisPlusInterceptor</span> <span class="variable">mybatisPlusInterceptor</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">MybatisPlusInterceptor</span>();</span><br><span class="line">        <span class="comment">// 添加分页拦截器</span></span><br><span class="line">        mybatisPlusInterceptor.addInnerInterceptor(<span class="keyword">new</span> <span class="title class_">PaginationInnerInterceptor</span>());</span><br><span class="line">        <span class="comment">// 返回MybatisPlusInterceptor实例</span></span><br><span class="line">        <span class="keyword">return</span> mybatisPlusInterceptor;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>分页操作就是在拦截器里面执行的，所以向new一个拦截器，再new一个分页插件</strong></p>
<p>完整代码</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@GetMapping(&quot;/page&quot;)</span></span><br><span class="line"><span class="keyword">public</span> R&lt;Page&gt; <span class="title function_">page</span><span class="params">(<span class="type">int</span> page, <span class="type">int</span> pageSize, String name)</span> &#123;</span><br><span class="line">    log.info(<span class="string">&quot;page:&#123;&#125;,pageSize:&#123;&#125;,name:&#123;&#125;&quot;</span>, page, pageSize, name);</span><br><span class="line">    <span class="comment">//构造分页构造器</span></span><br><span class="line">    <span class="type">Page</span> <span class="variable">pageInfo</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Page</span>(page, pageSize);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//构造条件构造器</span></span><br><span class="line">    LambdaQueryWrapper&lt;Employee&gt; queryWrapper = <span class="keyword">new</span> <span class="title class_">LambdaQueryWrapper</span>&lt;&gt;();</span><br><span class="line"></span><br><span class="line">    queryWrapper.like(StringUtils.isNotEmpty(name), Employee::getName, name);</span><br><span class="line">    <span class="comment">//排序条件</span></span><br><span class="line">    queryWrapper.orderByDesc(Employee::getUpdateTime);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//执行查询</span></span><br><span class="line">    employeeService.page(pageInfo, queryWrapper);</span><br><span class="line">    <span class="keyword">return</span> R.success(pageInfo);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="9-启用-禁用员工"><a href="#9-启用-禁用员工" class="headerlink" title="9.启用&#x2F;禁用员工"></a>9.启用&#x2F;禁用员工</h2><h3 id="9-1需求分析"><a href="#9-1需求分析" class="headerlink" title="9.1需求分析"></a>9.1需求分析</h3><ul>
<li><p>在员工管理列表页面，可以对某个员工账号进行启用或者禁用操作。账号禁用的员工不能登录系统，启用后的员工<br>可以正常登录。</p>
</li>
<li><p>需要注意，只有管理员(admi用户)可以对其他普通用户进行启用、禁用操作，所以普通用户登录系统后启用、<br>禁用按钮不显示。</p>
</li>
</ul>
<p>按钮是动态的</p>
<p><img src="/assets/Snipaste_2024-04-30_13-03-10-1715058981803-12.png"></p>
<p>普通员工登陆是看不到禁用按钮的</p>
<p><img src="/assets/Snipaste_2024-04-30_13-03-50-1715058981803-13.png"></p>
<p>前端页码分析</p>
<p><img src="/assets/Snipaste_2024-04-30_13-05-06-1715058981803-14.png"></p>
<h3 id="9-2网页中ajax请求是如何发送的"><a href="#9-2网页中ajax请求是如何发送的" class="headerlink" title="9.2网页中ajax请求是如何发送的"></a>9.2网页中ajax请求是如何发送的</h3><p><img src="/assets/Snipaste_2024-04-30_13-48-15-1715058981803-15.png"></p>
<h3 id="9-3代码开发"><a href="#9-3代码开发" class="headerlink" title="9.3代码开发"></a>9.3代码开发</h3><p><img src="/assets/Snipaste_2024-04-30_13-13-36-1715058981803-16.png"></p>
<p><strong>本质上是更新操作,status字段</strong></p>
<p>完整代码</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 使用@PutMapping注解，表示该方法为put请求，映射到update方法</span></span><br><span class="line">   <span class="meta">@PutMapping</span></span><br><span class="line">   <span class="comment">// 返回R&lt;String&gt;类型的结果，表示返回一个包含String的响应实体类</span></span><br><span class="line">   <span class="keyword">public</span> R&lt;String&gt; <span class="title function_">update</span><span class="params">(HttpServletRequest request, <span class="meta">@RequestBody</span> Employee employee)</span> &#123;</span><br><span class="line">       <span class="comment">// 设置员工的更新时间</span></span><br><span class="line">       employee.setUpdateTime(LocalDateTime.now());</span><br><span class="line">       <span class="comment">// 设置员工的更新用户</span></span><br><span class="line">       employee.setUpdateUser((Long) request.getSession().getAttribute(<span class="string">&quot;employee&quot;</span>));</span><br><span class="line">       <span class="comment">// 调用员工服务层的updateById方法，更新员工信息</span></span><br><span class="line">       employeeService.updateById(employee);</span><br><span class="line">       <span class="comment">// 返回成功响应</span></span><br><span class="line">       <span class="keyword">return</span> R.success(<span class="string">&quot;员工信息修改成功&quot;</span>);</span><br></pre></td></tr></table></figure>

<h4 id="精度丢失-陌生"><a href="#精度丢失-陌生" class="headerlink" title="精度丢失(陌生)"></a>精度丢失(陌生)</h4><p><img src="/assets/Snipaste_2024-04-30_15-03-34-1715058981803-17.png"></p>
<p>只能保证16位是精确的,之后的四舍五入</p>
<p><img src="/assets/Snipaste_2024-04-30_15-06-22-1715058981803-18.png"></p>
<h4 id="如何使用webMVC-陌生"><a href="#如何使用webMVC-陌生" class="headerlink" title="如何使用webMVC(陌生)"></a>如何使用webMVC(陌生)</h4><p><img src="/assets/Snipaste_2024-04-30_15-09-38-1715058981803-19.png"></p>
<p>导入类</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> com.fasterxml.jackson.databind.DeserializationFeature.FAIL_ON_UNKNOWN_PROPERTIES;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 对象映射器:基于jackson将Java对象转为json，或者将json转为Java对象</span></span><br><span class="line"><span class="comment"> * 将JSON解析为Java对象的过程称为 [从JSON反序列化Java对象]</span></span><br><span class="line"><span class="comment"> * 从Java对象生成JSON的过程称为 [序列化Java对象到JSON]</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">JacksonObjectMapper</span> <span class="keyword">extends</span> <span class="title class_">ObjectMapper</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">DEFAULT_DATE_FORMAT</span> <span class="operator">=</span> <span class="string">&quot;yyyy-MM-dd&quot;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">DEFAULT_DATE_TIME_FORMAT</span> <span class="operator">=</span> <span class="string">&quot;yyyy-MM-dd HH:mm:ss&quot;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">DEFAULT_TIME_FORMAT</span> <span class="operator">=</span> <span class="string">&quot;HH:mm:ss&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">JacksonObjectMapper</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="built_in">super</span>();</span><br><span class="line">        <span class="comment">//收到未知属性时不报异常</span></span><br><span class="line">        <span class="built_in">this</span>.configure(FAIL_ON_UNKNOWN_PROPERTIES, <span class="literal">false</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//反序列化时，属性不存在的兼容处理</span></span><br><span class="line">        <span class="built_in">this</span>.getDeserializationConfig().withoutFeatures(DeserializationFeature.FAIL_ON_UNKNOWN_PROPERTIES);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="type">SimpleModule</span> <span class="variable">simpleModule</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SimpleModule</span>()</span><br><span class="line">                .addDeserializer(LocalDateTime.class, <span class="keyword">new</span> <span class="title class_">LocalDateTimeDeserializer</span>(DateTimeFormatter.ofPattern(DEFAULT_DATE_TIME_FORMAT)))</span><br><span class="line">                .addDeserializer(LocalDate.class, <span class="keyword">new</span> <span class="title class_">LocalDateDeserializer</span>(DateTimeFormatter.ofPattern(DEFAULT_DATE_FORMAT)))</span><br><span class="line">                .addDeserializer(LocalTime.class, <span class="keyword">new</span> <span class="title class_">LocalTimeDeserializer</span>(DateTimeFormatter.ofPattern(DEFAULT_TIME_FORMAT)))</span><br><span class="line"></span><br><span class="line">                .addSerializer(BigInteger.class, ToStringSerializer.instance)</span><br><span class="line">                .addSerializer(Long.class, ToStringSerializer.instance)</span><br><span class="line">                .addSerializer(LocalDateTime.class, <span class="keyword">new</span> <span class="title class_">LocalDateTimeSerializer</span>(DateTimeFormatter.ofPattern(DEFAULT_DATE_TIME_FORMAT)))</span><br><span class="line">                .addSerializer(LocalDate.class, <span class="keyword">new</span> <span class="title class_">LocalDateSerializer</span>(DateTimeFormatter.ofPattern(DEFAULT_DATE_FORMAT)))</span><br><span class="line">                .addSerializer(LocalTime.class, <span class="keyword">new</span> <span class="title class_">LocalTimeSerializer</span>(DateTimeFormatter.ofPattern(DEFAULT_TIME_FORMAT)));</span><br><span class="line"></span><br><span class="line">        <span class="comment">//注册功能模块 例如，可以添加自定义序列化器和反序列化器</span></span><br><span class="line">        <span class="built_in">this</span>.registerModule(simpleModule);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>





<p><strong>先创建转换器  因为 转换器有我们需要的方法-》将java对象转换为json  new出来以后使用该方法转换 然后把转换器放在第一位，保证我们的转换器能够优先使用</strong></p>
<h4 id="在WebMvcConfig中创建消息转换器-陌生"><a href="#在WebMvcConfig中创建消息转换器-陌生" class="headerlink" title="在WebMvcConfig中创建消息转换器(陌生)"></a>在WebMvcConfig中创建消息转换器(陌生)</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">extendMessageConverters</span><span class="params">(List&lt;HttpMessageConverter&lt;?&gt;&gt; converters)</span>&#123;</span><br><span class="line">    <span class="comment">//创建消息转换器</span></span><br><span class="line">    <span class="type">MappingJackson2HttpMessageConverter</span> <span class="variable">messageConverter</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">MappingJackson2HttpMessageConverter</span>();</span><br><span class="line"></span><br><span class="line">    <span class="comment">//设置对象转换器，底层使用Jackson将Java对象转为json</span></span><br><span class="line">    messageConverter.setObjectMapper(<span class="keyword">new</span> <span class="title class_">JacksonObjectMapper</span>());</span><br><span class="line"></span><br><span class="line">    converters.add(<span class="number">0</span>,messageConverter);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="10-编辑员工信息"><a href="#10-编辑员工信息" class="headerlink" title="10.编辑员工信息"></a>10.编辑员工信息</h2><h3 id="10-1需求分析"><a href="#10-1需求分析" class="headerlink" title="10.1需求分析"></a>10.1需求分析</h3><p><img src="/assets/Snipaste_2024-04-30_18-22-01-1715058981803-21.png"></p>
<h3 id="10-2代码开发-梳理流程"><a href="#10-2代码开发-梳理流程" class="headerlink" title="10.2代码开发-梳理流程"></a>10.2代码开发-梳理流程</h3><p><img src="/assets/Snipaste_2024-04-30_18-36-53-1715058981803-20.png"></p>
<p>完整代码</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@GetMapping(&quot;&#123;id&#125;&quot;)</span></span><br><span class="line"><span class="keyword">public</span> R&lt;Employee&gt; <span class="title function_">getById</span><span class="params">(<span class="meta">@PathVariable</span> Long id)</span> &#123;</span><br><span class="line">    log.info(<span class="string">&quot;用户id是:&#123;&#125;&quot;</span>, id);</span><br><span class="line">    <span class="type">Employee</span> <span class="variable">employee</span> <span class="operator">=</span> employeeService.getById(id);</span><br><span class="line">    <span class="keyword">if</span> (employee != <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> R.success(employee);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> R.error(<span class="string">&quot;没有查询到对应员工信息&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="11-分类管理"><a href="#11-分类管理" class="headerlink" title="11.分类管理"></a>11.分类管理</h2><h3 id="11-1公共字段自动填充-必会"><a href="#11-1公共字段自动填充-必会" class="headerlink" title="11.1公共字段自动填充(必会)"></a>11.1公共字段自动填充(必会)</h3><h4 id="问题分析"><a href="#问题分析" class="headerlink" title="问题分析"></a>问题分析</h4><p>不仅仅针对员工表,其他表格一样通用</p>
<p><img src="/assets/Snipaste_2024-04-30_19-26-03-1715058981803-23.png"></p>
<h4 id="代码实现-1"><a href="#代码实现-1" class="headerlink" title="代码实现"></a>代码实现</h4><p>Mybatis Plus公共字段自动填充，也就是在插入或者更新的时候为指定字段赋予指定的值，使用它的好处就是可以<br>统一对这些字段进行处理，避免了<strong>重复代码</strong>。<br>实现步骤：<br>1、在实体类的属性上加入**@TableField<strong>注解，指定自动填充的策略<br>2、按照框架要求编写</strong>元数据对象处理器**，在此类中统一为公共字段赋值，此类需要实现MetaObjectHandler接口</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/** 记录创建时间 */</span></span><br><span class="line"><span class="meta">@TableField(fill = FieldFill.INSERT)</span></span><br><span class="line"><span class="keyword">private</span> LocalDateTime createTime;</span><br><span class="line"><span class="comment">/** 记录更新时间 */</span></span><br><span class="line"><span class="meta">@TableField(fill = FieldFill.INSERT_UPDATE)</span></span><br><span class="line"><span class="keyword">private</span> LocalDateTime updateTime;</span><br><span class="line"></span><br><span class="line"><span class="comment">/** 记录创建用户 */</span></span><br><span class="line"><span class="meta">@TableField(fill = FieldFill.INSERT)</span></span><br><span class="line"><span class="keyword">private</span> Long createUser;</span><br><span class="line"><span class="comment">/** 记录更新用户 */</span></span><br><span class="line"><span class="meta">@TableField(fill = FieldFill.INSERT_UPDATE)</span></span><br><span class="line"><span class="keyword">private</span> Long updateUser;</span><br></pre></td></tr></table></figure>

<p><img src="/assets/Snipaste_2024-04-30_19-33-51-1715058981803-22.png"></p>
<p>完整代码</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> cn.itheima.reggie.common;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyMetaObjectHandler</span> <span class="keyword">implements</span> <span class="title class_">MetaObjectHandler</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//实现父类的insertFill方法，用于在添加数据到数据库之前进行填充操作</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">insertFill</span><span class="params">(MetaObject metaObject)</span> &#123;</span><br><span class="line">        metaObject.setValue(<span class="string">&quot;createTime&quot;</span>, LocalDateTime.now());</span><br><span class="line">        metaObject.setValue(<span class="string">&quot;updateTime&quot;</span>, LocalDateTime.now());</span><br><span class="line">        metaObject.setValue(<span class="string">&quot;createUser&quot;</span>, <span class="keyword">new</span> <span class="title class_">Long</span>(<span class="number">1</span>));</span><br><span class="line">        metaObject.setValue(<span class="string">&quot;updateUser&quot;</span>, <span class="keyword">new</span> <span class="title class_">Long</span>(<span class="number">1</span>));</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 实现SqlSessionTemplate中的updateFill方法，用于自动更新填充某些字段</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">updateFill</span><span class="params">(MetaObject metaObject)</span> &#123;</span><br><span class="line">        metaObject.setValue(<span class="string">&quot;updateTime&quot;</span>, LocalDateTime.now());</span><br><span class="line">        metaObject.setValue(<span class="string">&quot;updateUser&quot;</span>, <span class="keyword">new</span> <span class="title class_">Long</span>(<span class="number">1</span>));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="功能完善"><a href="#功能完善" class="headerlink" title="功能完善"></a>功能完善</h4><p>注意：当前我们设置createUser和updateUser为固定值<br>后面我们需要进行改造，改为动态获得当前登录用户的</p>
<p><img src="/assets/Snipaste_2024-04-30_19-57-24-1715058981803-25.png"></p>
<h4 id="什么是ThreadLocal"><a href="#什么是ThreadLocal" class="headerlink" title="什么是ThreadLocal"></a>什么是ThreadLocal</h4><p><strong>ThreadLocal</strong>并不是一个Thread,而是Thread的局部变量。当使用ThreadLocal维护<strong>变量</strong>时，ThreadLocal为每个使用该变量的线程提供<strong>独立的变量副本</strong>，所以每一个线程都可以独立地改变自己的副本，而不会影响其它线程所对应的副本。<br>ThreadLocal为每个线程提供<u><strong>单独一份存储空间</strong></u>，具有线程隔离的效果，只有在线程内才能获取到对应的值：线程外则不能访问。</p>
<p>ThreadLocal常用方法：</p>
<p>**public void set(T value) **             设置当前线程的线程局部变量的值</p>
<p><strong>public T get()</strong>                       返回当前线程所对应的线程局部变量的值</p>
<p>我们可以在LoginCheckFilter的doFilter,方法中获取当前登录用户id,并调用ThreadLocal的set方法来设置当前线程的线程局部变量的值（用户id),然后在MyMetaObjectHandler的updateFill方法中调用ThreadLocall的get方法来获得当前线程所对应的线程局部变量的值（用户id)。</p>
<h4 id="代码实现-2"><a href="#代码实现-2" class="headerlink" title="代码实现"></a>代码实现</h4><p><img src="/assets/Snipaste_2024-04-30_20-07-40-1715058981803-24.png"></p>
<h5 id="1-BaseContext工具类-陌生"><a href="#1-BaseContext工具类-陌生" class="headerlink" title="1.BaseContext工具类(陌生)"></a>1.BaseContext工具类(陌生)</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> cn.itheima.reggie.common;</span><br><span class="line"><span class="comment">//基于ThreadLocal封装工具类，用户保存和获取当前登录用户id</span></span><br><span class="line"><span class="comment">//作用范围只在线程之内</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">BaseContext</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> ThreadLocal&lt;Long&gt; threadLocal =<span class="keyword">new</span> <span class="title class_">ThreadLocal</span>&lt;&gt;();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">setCurrentId</span><span class="params">(Long id)</span>&#123;</span><br><span class="line">        threadLocal.set(id);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Long <span class="title function_">getCurrentId</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> threadLocal.get();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="2-在LoginCheckFilter中添加"><a href="#2-在LoginCheckFilter中添加" class="headerlink" title="2.在LoginCheckFilter中添加"></a>2.在LoginCheckFilter中添加</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//4、判断登录状态，如果已登录，则直接放行</span></span><br><span class="line">        <span class="keyword">if</span> (request.getSession().getAttribute(<span class="string">&quot;employee&quot;</span>) != <span class="literal">null</span>) &#123;</span><br><span class="line">         log.info(<span class="string">&quot;用户已登录:&#123;&#125;&quot;</span>,request.getSession().getAttribute(<span class="string">&quot;employee&quot;</span>) );</span><br><span class="line"></span><br><span class="line">            <span class="type">Long</span> <span class="variable">empId</span> <span class="operator">=</span> (Long) request.getSession().getAttribute(<span class="string">&quot;employee&quot;</span>);            filterChain.doFilter(request, response);</span><br><span class="line">            BaseContext.setCurrentId(empId);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br></pre></td></tr></table></figure>

<h5 id="3-在MyMetaObjectHandler-BaseContext-getCurrentId-用方法替换固定值"><a href="#3-在MyMetaObjectHandler-BaseContext-getCurrentId-用方法替换固定值" class="headerlink" title="3.在MyMetaObjectHandler&#x3D;&gt;BaseContext.getCurrentId()用方法替换固定值"></a>3.在MyMetaObjectHandler&#x3D;&gt;BaseContext.getCurrentId()用方法替换固定值</h5><p>完整代码</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> cn.itheima.reggie.common;</span><br><span class="line"><span class="comment">//自定义元数据对象处理器</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyMetaObjectHandler</span> <span class="keyword">implements</span> <span class="title class_">MetaObjectHandler</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//实现父类的insertFill方法，用于在添加数据到数据库之前进行填充操作</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">insertFill</span><span class="params">(MetaObject metaObject)</span> &#123;</span><br><span class="line">        metaObject.setValue(<span class="string">&quot;createTime&quot;</span>, LocalDateTime.now());</span><br><span class="line">        metaObject.setValue(<span class="string">&quot;updateTime&quot;</span>, LocalDateTime.now());</span><br><span class="line">        metaObject.setValue(<span class="string">&quot;createUser&quot;</span>, BaseContext.getCurrentId());</span><br><span class="line">        metaObject.setValue(<span class="string">&quot;updateUser&quot;</span>, BaseContext.getCurrentId());</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 实现SqlSessionTemplate中的updateFill方法，用于自动更新填充某些字段</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">updateFill</span><span class="params">(MetaObject metaObject)</span> &#123;</span><br><span class="line">        metaObject.setValue(<span class="string">&quot;updateTime&quot;</span>,  LocalDateTime.now());</span><br><span class="line">        metaObject.setValue(<span class="string">&quot;updateUser&quot;</span>,  BaseContext.getCurrentId());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="11-2新增分类"><a href="#11-2新增分类" class="headerlink" title="11.2新增分类"></a>11.2新增分类</h3><h4 id="需求分析"><a href="#需求分析" class="headerlink" title="需求分析"></a>需求分析</h4><p><img src="/assets/Snipaste_2024-04-30_23-04-39-1715058981804-26.png"></p>
<p><img src="/assets/Snipaste_2024-04-30_23-06-33-1715058981804-27.png"></p>
<p><img src="/assets/Snipaste_2024-04-30_19-26-03-1715058981803-23.png" alt="Snipaste_2024-04-30_19-26-03"></p>
<p><img src="/assets/Snipaste_2024-04-30_23-11-39-1715058981804-28.png"></p>
<h4 id="开发业务功"><a href="#开发业务功" class="headerlink" title="开发业务功"></a>开发业务功</h4><p>在开发业务功能前，先将需要用到的类和接口基本结构创建好：<br>●实体类Category(直接从课程资料中导入即可)</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> cn.itheima.reggie.entity;</span><br><span class="line"> * 分类</span><br><span class="line"> */</span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Category</span> <span class="keyword">implements</span> <span class="title class_">Serializable</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">long</span> <span class="variable">serialVersionUID</span> <span class="operator">=</span> <span class="number">1L</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Long id;</span><br><span class="line">    <span class="comment">//类型 1 菜品分类 2 套餐分类</span></span><br><span class="line">    <span class="keyword">private</span> Integer type;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//分类名称</span></span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//顺序</span></span><br><span class="line">    <span class="keyword">private</span> Integer sort;</span><br><span class="line">    <span class="comment">//创建时间</span></span><br><span class="line">    <span class="meta">@TableField(fill = FieldFill.INSERT)</span></span><br><span class="line">    <span class="keyword">private</span> LocalDateTime createTime;</span><br><span class="line">    <span class="comment">//更新时间</span></span><br><span class="line">    <span class="meta">@TableField(fill = FieldFill.INSERT_UPDATE)</span></span><br><span class="line">    <span class="keyword">private</span> LocalDateTime updateTime;</span><br><span class="line">    <span class="comment">//创建人</span></span><br><span class="line">    <span class="meta">@TableField(fill = FieldFill.INSERT)</span></span><br><span class="line">    <span class="keyword">private</span> Long createUser;</span><br><span class="line">	 <span class="comment">//修改人</span></span><br><span class="line">    <span class="meta">@TableField(fill = FieldFill.INSERT_UPDATE)</span></span><br><span class="line">    <span class="keyword">private</span> Long updateUser;</span><br><span class="line">    <span class="comment">//是否删除</span></span><br><span class="line">    <span class="keyword">private</span> Integer isDeleted;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>●Mapper接口CategoryMapper</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Mapper</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">CategoryMapper</span> <span class="keyword">extends</span> <span class="title class_">BaseMapper</span>&lt;Category&gt; &#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>●业务层实现类CategoryServicelmpl</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CategoryServiceImpl</span> <span class="keyword">extends</span> <span class="title class_">ServiceImpl</span>&lt;CategoryMapper, Category&gt; <span class="keyword">implements</span> <span class="title class_">CategoryService</span> &#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>● 控制层CategoryController<br><img src="/assets/Snipaste_2024-04-30_23-27-25-1715058981804-29.png"></p>
<p>完整代码</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> cn.itheima.reggie.controller;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/category&quot;)</span></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CategoryController</span> &#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> CategoryService categoryService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@PostMapping</span></span><br><span class="line">    <span class="keyword">public</span> R&lt;String&gt; <span class="title function_">save</span><span class="params">(<span class="meta">@RequestBody</span> Category category)</span> &#123;</span><br><span class="line">        log.info(<span class="string">&quot;category:&#123;&#125;&quot;</span>, category);</span><br><span class="line">        categoryService.save(category);</span><br><span class="line">        <span class="keyword">return</span> R.success(<span class="string">&quot;新增分类成功&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>11.3分页查询</p>
<p><img src="/assets/Snipaste_2024-04-30_23-47-24-1715058981804-30.png"></p>
<p>完整代码</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@GetMapping(&quot;/page&quot;)</span></span><br><span class="line">  <span class="keyword">public</span> R&lt;Page&gt; <span class="title function_">page</span><span class="params">(<span class="type">int</span> page, <span class="type">int</span> pageSize)</span> &#123;</span><br><span class="line">      log.info(<span class="string">&quot;page:&#123;&#125;,pageSize:&#123;&#125;,name:&#123;&#125;&quot;</span>, page, pageSize);</span><br><span class="line">      <span class="comment">//构造分页构造器</span></span><br><span class="line">      <span class="type">Page</span> <span class="variable">pageInfo</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Page</span>(page, pageSize);</span><br><span class="line"></span><br><span class="line">      <span class="comment">//构造条件构造器</span></span><br><span class="line">      LambdaQueryWrapper&lt;Category&gt; queryWrapper = <span class="keyword">new</span> <span class="title class_">LambdaQueryWrapper</span>&lt;&gt;();</span><br><span class="line"></span><br><span class="line">      <span class="comment">//排序条件</span></span><br><span class="line">      queryWrapper.orderByDesc(Category::getSort);</span><br><span class="line"></span><br><span class="line">      <span class="comment">//执行查询</span></span><br><span class="line">      categoryService.page(pageInfo, queryWrapper);</span><br><span class="line">      <span class="keyword">return</span> R.success(pageInfo);</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>

<h3 id="11-3-删除分类"><a href="#11-3-删除分类" class="headerlink" title="11.3.删除分类"></a>11.3.删除分类</h3><h4 id="需求分析-1"><a href="#需求分析-1" class="headerlink" title="需求分析"></a>需求分析</h4><p>关联菜品不可删除</p>
<p><img src="/assets/Snipaste_2024-05-01_10-12-29-1715058981804-31.png"></p>
<h4 id="代码开发"><a href="#代码开发" class="headerlink" title="代码开发"></a>代码开发</h4><p><img src="/assets/Snipaste_2024-05-01_10-13-50-1715058981804-32.png"></p>
<p>用PathVariable是因为url用了占位符（”&#x2F;{id}”）所以加@PathVariable，而deleteMapping<strong>不要用占位符</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@DeleteMapping</span></span><br><span class="line"><span class="keyword">public</span> R&lt;String&gt; <span class="title function_">delete</span><span class="params">(Long ids)</span> &#123;</span><br><span class="line">    log.info(<span class="string">&quot;删除:&#123;&#125;&quot;</span>, ids);</span><br><span class="line">    categoryService.removeById(ids);</span><br><span class="line">    <span class="keyword">return</span> R.success(<span class="string">&quot;分类信息删除成功&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="功能完善-陌生"><a href="#功能完善-陌生" class="headerlink" title="功能完善(陌生)"></a>功能完善(陌生)</h4><p><img src="/assets/Snipaste_2024-05-01_10-26-56-1715058981804-33.png"></p>
<p>实体类Dish和Setmeal</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> cn.itheima.reggie.entity;</span><br><span class="line"> 菜品</span><br><span class="line"> */</span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Dish</span> <span class="keyword">implements</span> <span class="title class_">Serializable</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">long</span> <span class="variable">serialVersionUID</span> <span class="operator">=</span> <span class="number">1L</span>;</span><br><span class="line">    <span class="keyword">private</span> Long id;</span><br><span class="line">    <span class="comment">//菜品名称</span></span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">   <span class="comment">//菜品分类id</span></span><br><span class="line">    <span class="keyword">private</span> Long categoryId;</span><br><span class="line">    <span class="comment">//菜品价格</span></span><br><span class="line">    <span class="keyword">private</span> BigDecimal price;</span><br><span class="line">    <span class="comment">//商品码</span></span><br><span class="line">    <span class="keyword">private</span> String code;</span><br><span class="line">    <span class="comment">//图片</span></span><br><span class="line">    <span class="keyword">private</span> String image;</span><br><span class="line">    <span class="comment">//描述信息</span></span><br><span class="line">    <span class="keyword">private</span> String description;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//0 停售 1 起售</span></span><br><span class="line">    <span class="keyword">private</span> Integer status;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//顺序</span></span><br><span class="line">    <span class="keyword">private</span> Integer sort;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@TableField(fill = FieldFill.INSERT)</span></span><br><span class="line">    <span class="keyword">private</span> LocalDateTime createTime;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@TableField(fill = FieldFill.INSERT_UPDATE)</span></span><br><span class="line">    <span class="keyword">private</span> LocalDateTime updateTime;</span><br><span class="line">    <span class="meta">@TableField(fill = FieldFill.INSERT)</span></span><br><span class="line">    <span class="keyword">private</span> Long createUser;</span><br><span class="line">    <span class="meta">@TableField(fill = FieldFill.INSERT_UPDATE)</span></span><br><span class="line">    <span class="keyword">private</span> Long updateUser;</span><br><span class="line">    <span class="comment">//是否删除</span></span><br><span class="line">    <span class="keyword">private</span> Integer isDeleted;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> cn.itheima.reggie.entity;</span><br><span class="line"> * 套餐</span><br><span class="line"> */</span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Setmeal</span> <span class="keyword">implements</span> <span class="title class_">Serializable</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">long</span> <span class="variable">serialVersionUID</span> <span class="operator">=</span> <span class="number">1L</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Long id;</span><br><span class="line">    <span class="comment">//分类id</span></span><br><span class="line">    <span class="keyword">private</span> Long categoryId;</span><br><span class="line">    <span class="comment">//套餐名称</span></span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="comment">//套餐价格</span></span><br><span class="line">    <span class="keyword">private</span> BigDecimal price;</span><br><span class="line">    <span class="comment">//状态 0:停用 1:启用</span></span><br><span class="line">    <span class="keyword">private</span> Integer status;</span><br><span class="line">    <span class="comment">//编码</span></span><br><span class="line">    <span class="keyword">private</span> String code;</span><br><span class="line">    <span class="comment">//描述信息</span></span><br><span class="line">    <span class="keyword">private</span> String description;</span><br><span class="line">   <span class="comment">//图片</span></span><br><span class="line">    <span class="keyword">private</span> String image;</span><br><span class="line">    <span class="meta">@TableField(fill = FieldFill.INSERT)</span></span><br><span class="line">    <span class="keyword">private</span> LocalDateTime createTime;</span><br><span class="line">    <span class="meta">@TableField(fill = FieldFill.INSERT_UPDATE)</span></span><br><span class="line">    <span class="keyword">private</span> LocalDateTime updateTime;</span><br><span class="line">    <span class="meta">@TableField(fill = FieldFill.INSERT)</span></span><br><span class="line">    <span class="keyword">private</span> Long createUser;</span><br><span class="line">    <span class="meta">@TableField(fill = FieldFill.INSERT_UPDATE)</span></span><br><span class="line">    <span class="keyword">private</span> Long updateUser;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//是否删除</span></span><br><span class="line">    <span class="keyword">private</span> Integer isDeleted;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>Mapper接口DishMapper</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Mapper</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">DishMapper</span> <span class="keyword">extends</span> <span class="title class_">BaseMapper</span>&lt;Dish&gt; &#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>和SetmealMapper</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Mapper</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">SetmealMapper</span> <span class="keyword">extends</span> <span class="title class_">BaseMapper</span>&lt;Setmeal&gt; &#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Service:接口DishService</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">DishService</span> <span class="keyword">extends</span> <span class="title class_">IService</span>&lt;Dish&gt; &#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>和SetmealService</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">SetmealService</span> <span class="keyword">extends</span> <span class="title class_">IService</span>&lt;Setmeal&gt; &#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Service实现类DishServicelmpli</p>
<p>和SetmealServicelmpl</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SetmealServicelmpl</span> <span class="keyword">extends</span> <span class="title class_">ServiceImpl</span>&lt;SetmealMapper, Setmeal&gt; <span class="keyword">implements</span> <span class="title class_">SetmealService</span> &#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>CategoryController中替换remove方法</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">    <span class="meta">@DeleteMapping</span></span><br><span class="line">    <span class="keyword">public</span> R&lt;String&gt; <span class="title function_">delete</span><span class="params">(Long ids)</span> &#123;</span><br><span class="line">        log.info(<span class="string">&quot;删除:&#123;&#125;&quot;</span>, ids);</span><br><span class="line">        categoryService.remove(ids);</span><br><span class="line"><span class="comment">//        categoryService.removeById(ids);</span></span><br><span class="line">        <span class="keyword">return</span> R.success(<span class="string">&quot;分类信息删除成功&quot;</span>);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>



<p>创建异常收集类</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CustomException</span> <span class="keyword">extends</span> <span class="title class_">RuntimeException</span>&#123;</span><br><span class="line"><span class="keyword">public</span> <span class="title function_">CustomException</span> <span class="params">(String message)</span>&#123;</span><br><span class="line">    <span class="built_in">super</span>(message);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>GlobalExceptionHandler中添加异常类</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ExceptionHandler(CustomException.class)</span></span><br><span class="line">   <span class="keyword">public</span> R&lt;String&gt; <span class="title function_">CustomException</span><span class="params">(CustomException cx)</span> &#123;</span><br><span class="line">       log.error(cx.getMessage());</span><br><span class="line"></span><br><span class="line">       <span class="keyword">return</span> R.error(cx.getMessage());</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>

<p>service中 </p>
<p>完整代码</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> cn.itheima.reggie.service.impl;</span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CategoryServiceImpl</span> <span class="keyword">extends</span> <span class="title class_">ServiceImpl</span>&lt;CategoryMapper, Category&gt; <span class="keyword">implements</span> <span class="title class_">CategoryService</span> &#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> DishService dishService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> SetmealService setmealService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">remove</span><span class="params">(Long id)</span> &#123;</span><br><span class="line">        <span class="comment">//查询当前分类是否关联菜品,如果关联,抛出一个业务异常</span></span><br><span class="line">        LambdaQueryWrapper&lt;Dish&gt; dishLambdaQueryWrapper = <span class="keyword">new</span> <span class="title class_">LambdaQueryWrapper</span>&lt;&gt;();</span><br><span class="line">        <span class="comment">//添加查询条件</span></span><br><span class="line">        dishLambdaQueryWrapper.eq(Dish::getCategoryId, id);</span><br><span class="line">        <span class="comment">//判断条件总数</span></span><br><span class="line">        <span class="type">int</span> <span class="variable">count</span> <span class="operator">=</span> dishService.count(dishLambdaQueryWrapper);</span><br><span class="line">        <span class="keyword">if</span> (count &gt; <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="comment">//已经关联了菜品,抛出一个异常</span></span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">CustomException</span>(<span class="string">&quot;当前分类下的关联菜品,不能被删除&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//查询当前分类是否关联套餐,如果关联,抛出一个业务异常</span></span><br><span class="line">        LambdaQueryWrapper&lt;Setmeal&gt; setmealLambdaQueryWrapper = <span class="keyword">new</span> <span class="title class_">LambdaQueryWrapper</span>&lt;&gt;();</span><br><span class="line">        setmealLambdaQueryWrapper.eq(Setmeal::getCategoryId, id);</span><br><span class="line">        <span class="type">int</span> <span class="variable">count1</span> <span class="operator">=</span> setmealService.count(setmealLambdaQueryWrapper);</span><br><span class="line">        <span class="keyword">if</span> (count1 &gt; <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="comment">//已经关联菜品,抛出一个异常</span></span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">CustomException</span>(<span class="string">&quot;当前分类下的套餐,不能被删除&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//正常删除分类</span></span><br><span class="line">        <span class="built_in">super</span>.removeById(id);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="11-4修改分类"><a href="#11-4修改分类" class="headerlink" title="11.4修改分类"></a>11.4修改分类</h3><p>需求分析</p>
<p><img src="/assets/Snipaste_2024-05-01_11-45-58-1715058981804-34.png"></p>
<p>代码开发 完整代码</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@PutMapping</span></span><br><span class="line"><span class="keyword">public</span> R&lt;String&gt; <span class="title function_">update</span><span class="params">(<span class="meta">@RequestBody</span> Category category)</span> &#123;</span><br><span class="line"></span><br><span class="line">    log.info(<span class="string">&quot;修改分类信息:&#123;&#125;&quot;</span>, category);</span><br><span class="line"></span><br><span class="line">    categoryService.updateById(category);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> R.success(<span class="string">&quot;修改分类信息成功&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h2 id="12-菜品管理"><a href="#12-菜品管理" class="headerlink" title="12.菜品管理"></a>12.菜品管理</h2><h4 id="12-1文件上传下载-陌生"><a href="#12-1文件上传下载-陌生" class="headerlink" title="12.1文件上传下载(陌生)"></a>12.1文件上传下载(陌生)</h4><h6 id="上传"><a href="#上传" class="headerlink" title="上传"></a>上传</h6><p><img src="/assets/Snipaste_2024-05-01_14-29-29-1715058981804-35.png"></p>
<p>现成的组件库</p>
<p><img src="/assets/Snipaste_2024-05-01_14-31-49-1715058981804-36.png"></p>
<p>服务端 </p>
<img src="assets/Snipaste_2024-05-01_14-32-57-1715058981804-37.png"  />



<h6 id="下载"><a href="#下载" class="headerlink" title="下载"></a>下载</h6><p><img src="/assets/Snipaste_2024-05-01_14-35-36-1715058981804-38.png"></p>
<h6 id="上传-代码实现"><a href="#上传-代码实现" class="headerlink" title="上传 代码实现"></a>上传 代码实现</h6><p><img src="/assets/Snipaste_2024-05-01_14-37-52-1715058981804-39.png"></p>
<p>yml配置项增加</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">reggie:</span></span><br><span class="line">  <span class="attr">path :</span> <span class="string">D:\BaiduNetdiskDownload\瑞吉外卖\reggi-pc\</span></span><br></pre></td></tr></table></figure>



<p>新增类 使用原始文件名方法</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> cn.itheima.reggie.controller;</span><br><span class="line"><span class="comment">//文件上传下载</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/common&quot;)</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CommonController</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Value(&quot;$&#123;reggie.path&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String bashPath;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">//file是一个临时文件，需要转存到指定位凰，否则本次请求完成后临时文件会刚除</span></span><br><span class="line">    <span class="meta">@PostMapping(&quot;/upload&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> R&lt;String&gt; <span class="title function_">upload</span><span class="params">(MultipartFile file)</span>&#123;</span><br><span class="line"></span><br><span class="line">    log.info(file.toString());</span><br><span class="line">        <span class="comment">//获取原始文件名</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">originalFilename</span> <span class="operator">=</span> file.getOriginalFilename();</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            file.transferTo(<span class="keyword">new</span> <span class="title class_">File</span>(bashPath+originalFilename));</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(e);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>使用uuid 完整代码 创建文件夹</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> cn.itheima.reggie.controller;</span><br><span class="line"><span class="comment">//文件上传下载</span></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/common&quot;)</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CommonController</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Value(&quot;$&#123;reggie.path&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String bashPath;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//file是一个临时文件，需要转存到指定位凰，否则本次请求完成后临时文件会刚除</span></span><br><span class="line">    <span class="meta">@PostMapping(&quot;/upload&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> R&lt;String&gt; <span class="title function_">upload</span><span class="params">(MultipartFile file)</span> &#123;</span><br><span class="line"></span><br><span class="line">        log.info(file.toString());</span><br><span class="line">        <span class="comment">//获取原始文件名</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">originalFilename</span> <span class="operator">=</span> file.getOriginalFilename();</span><br><span class="line"></span><br><span class="line">        <span class="comment">//使用uuid重新,生成文件名,防止重复</span></span><br><span class="line"></span><br><span class="line">        <span class="type">String</span> <span class="variable">fileName</span> <span class="operator">=</span> UUID.randomUUID().toString();</span><br><span class="line"></span><br><span class="line">        <span class="comment">//创建一个目录对象</span></span><br><span class="line">        <span class="type">File</span> <span class="variable">dir</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">File</span>(bashPath);</span><br><span class="line">        <span class="comment">//判断当前目录是否存在</span></span><br><span class="line">        <span class="keyword">if</span> (!dir.exists()) &#123;</span><br><span class="line">            <span class="comment">//不存在目录,需要创建</span></span><br><span class="line">            dir.mkdirs();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//  截取最后一个点</span></span><br><span class="line"></span><br><span class="line">        <span class="type">String</span> <span class="variable">suffix</span> <span class="operator">=</span> originalFilename.substring(originalFilename.lastIndexOf(<span class="string">&quot;.&quot;</span>));</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            file.transferTo(<span class="keyword">new</span> <span class="title class_">File</span>(bashPath + fileName + suffix));</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(e);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> R.success(fileName);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p> 文件名称需要保存到数据库</p>
<p> return R.success(fileName);</p>
<h6 id="下载代码实现"><a href="#下载代码实现" class="headerlink" title="下载代码实现"></a>下载代码实现</h6><p><img src="/assets/Snipaste_2024-05-01_17-41-04-1715058981804-40.png"></p>
<p>完整代码</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@GetMapping(&quot;/download&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">download</span><span class="params">(String name, HttpServletResponse response)</span> &#123;</span><br><span class="line">    <span class="comment">//输入流,读取文件内容</span></span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="type">FileInputStream</span> <span class="variable">fileInputStream</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FileInputStream</span>(<span class="keyword">new</span> <span class="title class_">File</span>(bashPath+name));</span><br><span class="line">        <span class="comment">//输出流,将文件写回游览器.</span></span><br><span class="line">        <span class="type">ServletOutputStream</span> <span class="variable">outputStream</span> <span class="operator">=</span> response.getOutputStream();</span><br><span class="line">        <span class="comment">// 使用setContentType()方法来设置HTTP响应的内容类型。</span></span><br><span class="line">        response.setContentType(<span class="string">&quot;image/jpeg&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="type">byte</span>[] bytes = <span class="keyword">new</span> <span class="title class_">byte</span>[<span class="number">1024</span>];</span><br><span class="line">        <span class="type">int</span> <span class="variable">len</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">while</span> ((len = fileInputStream.read(bytes)) != -<span class="number">1</span>) &#123;</span><br><span class="line">            outputStream.write(bytes, <span class="number">0</span>, len);</span><br><span class="line">            outputStream.flush();</span><br><span class="line">        &#125;</span><br><span class="line">        outputStream.close();</span><br><span class="line">        fileInputStream.close();</span><br><span class="line">    &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="12-2新增菜品"><a href="#12-2新增菜品" class="headerlink" title="12.2新增菜品"></a>12.2新增菜品</h4><h5 id="需求分析-2"><a href="#需求分析-2" class="headerlink" title="需求分析"></a>需求分析</h5><ul>
<li>后台系统中可以管理菜品信息，通过新增功能来添加一个新的菜品，在添加菜品时需要选择当前菜品所属的菜品分类，<br>并且需要上传菜品图片，在移动端会按照菜品分类来展示对应的菜品信息。</li>
<li><img src="/assets/Snipaste_2024-05-01_18-07-46-1715058981804-41.png"></li>
</ul>
<p>在开发业务功能前，先将需要用到的类和接口基本结构创建好：<br>●实体类DishFlavor</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> cn.itheima.reggie.entity;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">菜品口味</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DishFlavor</span> <span class="keyword">implements</span> <span class="title class_">Serializable</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">long</span> <span class="variable">serialVersionUID</span> <span class="operator">=</span> <span class="number">1L</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Long id;</span><br><span class="line">    <span class="comment">//菜品id</span></span><br><span class="line">    <span class="keyword">private</span> Long dishId;</span><br><span class="line">    <span class="comment">//口味名称</span></span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="comment">//口味数据list</span></span><br><span class="line">    <span class="keyword">private</span> String value;</span><br><span class="line">    <span class="meta">@TableField(fill = FieldFill.INSERT)</span></span><br><span class="line">    <span class="keyword">private</span> LocalDateTime createTime;</span><br><span class="line">   <span class="meta">@TableField(fill = FieldFill.INSERT_UPDATE)</span></span><br><span class="line">    <span class="keyword">private</span> LocalDateTime updateTime;</span><br><span class="line">    <span class="meta">@TableField(fill = FieldFill.INSERT)</span></span><br><span class="line">    <span class="keyword">private</span> Long createUser;</span><br><span class="line">    <span class="meta">@TableField(fill = FieldFill.INSERT_UPDATE)</span></span><br><span class="line">   <span class="keyword">private</span> Long updateUser;</span><br><span class="line">    <span class="comment">//是否删除</span></span><br><span class="line">    <span class="keyword">private</span> Integer isDeleted;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>●Mapper接▣DishFlavorMapper(略)<br>●业务层接▣DishFlavorService(略)<br>●业务层实现类DishFlavorServicelmpl(略)<br>●控制层DishController</p>
<h5 id="代码开发-梳理"><a href="#代码开发-梳理" class="headerlink" title="代码开发-梳理"></a>代码开发-梳理</h5><p><img src="/assets/Snipaste_2024-05-01_18-24-57-1715058981804-42.png"></p>
<p>1.在CategoryController中添加</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@GetMapping(&quot;/list&quot;)</span></span><br><span class="line"><span class="keyword">public</span> R&lt;List&lt;Category&gt;&gt; <span class="title function_">list</span><span class="params">(Category category)</span> &#123;</span><br><span class="line">    <span class="comment">//构造条件</span></span><br><span class="line">    LambdaQueryWrapper&lt;Category&gt; queryWrapper = <span class="keyword">new</span> <span class="title class_">LambdaQueryWrapper</span>&lt;&gt;();</span><br><span class="line">    <span class="comment">//1.判断不为空,2锁定type字段,3,拿到get值</span></span><br><span class="line">    queryWrapper.eq(category.getType() != <span class="literal">null</span>, Category::getType, category.getType());</span><br><span class="line">    <span class="comment">//  添加排序条件</span></span><br><span class="line">   queryWrapper.orderByAsc(Category::getSort);</span><br><span class="line">queryWrapper.orderByDesc(Category::getUpdateTime);</span><br><span class="line">    <span class="comment">//执行操作</span></span><br><span class="line">    List&lt;Category&gt; list = categoryService.list(queryWrapper);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> R.success(list);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>2.3.上传图片并 回显 12.1完成</p>
<h5 id="4-重点-双表联查-DTO"><a href="#4-重点-双表联查-DTO" class="headerlink" title="*4.(重点)双表联查&#x3D;&gt;DTO"></a>*4.(重点)双表联查&#x3D;&gt;DTO</h5><p>点击保存,发送ajax请求,已json方法保存</p>
<p><img src="/assets/Snipaste_2024-05-01_19-29-32-1715058981804-43.png"></p>
<p><strong>Data Transfer Object,数据传输对象</strong></p>
<p>导入类DTO</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> cn.itheima.reggie.dto;</span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DishDto</span> <span class="keyword">extends</span> <span class="title class_">Dish</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> List&lt;DishFlavor&gt; flavors = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">	<span class="comment">//暂时不用</span></span><br><span class="line">    <span class="keyword">private</span> String categoryName;</span><br><span class="line">	<span class="comment">//暂时不用</span></span><br><span class="line">    <span class="keyword">private</span> Integer copies;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>启动项加入@EnableTransactionManagement开启事务</p>
<p>DishController层 完整代码</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> cn.itheima.reggie.controller;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/dish&quot;)</span></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DishController</span> &#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> DishService dishService;</span><br><span class="line">    <span class="comment">//添加菜品</span></span><br><span class="line">    <span class="meta">@PostMapping</span></span><br><span class="line">    <span class="keyword">public</span> R&lt;String&gt; <span class="title function_">save</span><span class="params">(<span class="meta">@RequestBody</span>  DishDto dishDto)</span> &#123;</span><br><span class="line">        log.info(<span class="string">&quot;新增菜品信息:&#123;&#125;&quot;</span>, dishDto);</span><br><span class="line">        <span class="comment">//新增票品，同时插入菜品对应的口味数据，需要操作两张表：dish、dishFlavor</span></span><br><span class="line">        dishService.saveWithFlavor(dishDto);</span><br><span class="line">        <span class="keyword">return</span> R.success(<span class="string">&quot;新增菜品成功&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>service层 完整代码</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> cn.itheima.reggie.service.impl;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DishServicelmpli</span> <span class="keyword">extends</span> <span class="title class_">ServiceImpl</span>&lt;DishMapper, Dish&gt; <span class="keyword">implements</span> <span class="title class_">DishService</span> &#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> DishFlavorService dishFlavorService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">startOrStop</span><span class="params">(Long ids)</span> &#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 新增票品，同时插入菜品对应的口味数据，需要操作两张表：dish、dishFlavor</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="meta">@Transactional</span><span class="comment">//开启事务</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">saveWithFlavor</span><span class="params">(DishDto dishDto)</span> &#123;</span><br><span class="line">        <span class="comment">//保存菜品的基本信息到dish表中</span></span><br><span class="line">        <span class="built_in">this</span>.save(dishDto);</span><br><span class="line">        <span class="comment">//菜品id</span></span><br><span class="line">        <span class="type">Long</span> <span class="variable">dishId</span> <span class="operator">=</span> dishDto.getId();</span><br><span class="line">        <span class="comment">//菜品口味</span></span><br><span class="line">        List&lt;DishFlavor&gt; flavors = dishDto.getFlavors();</span><br><span class="line">        </span><br><span class="line">        <span class="comment">//以下是对一个名为`flavors`的列表进行处理，将其转换为一个新的列表，同时为每个元素设置一个`dishId`。</span></span><br><span class="line">        <span class="comment">//1. `flavors.stream()`：创建一个流，对`flavors`列表进行处理。</span></span><br><span class="line">        <span class="comment">//2. `.map((item)-&gt;&#123;`：使用`map`操作，对流中的每个元素进行处理。处理函数为一个匿名函数，参数为`item`，返回值为处理后的元素。</span></span><br><span class="line">        <span class="comment">//3. `item.setDishId(dishId);`：在处理函数中，为`item`设置`dishId`。</span></span><br><span class="line">        <span class="comment">//4. `return item;`：返回处理后的`item`。</span></span><br><span class="line">        <span class="comment">//5. `.collect(Collectors.toList());`：将处理后的流收集到一个新的列表中。</span></span><br><span class="line">        <span class="comment">//注意：这段代码的实现原理是将一个列表转换为另一个具有相同元素的新列表，同时为每个元素设置一个新的`dishId`。这个操作通常在数据处理时用于更新或填充数据库或其他数据存储。</span></span><br><span class="line">        flavors.stream().map((item) -&gt; &#123;</span><br><span class="line">            item.setDishId(dishId);</span><br><span class="line">            <span class="keyword">return</span> item;</span><br><span class="line">        &#125;).collect(Collectors.toList());</span><br><span class="line"><span class="comment">//可用</span></span><br><span class="line"><span class="comment">//        for (DishFlavor flavor : flavors) &#123;</span></span><br><span class="line"><span class="comment">//            flavor.setDishId(dishId);</span></span><br><span class="line"><span class="comment">//        &#125;</span></span><br><span class="line">        <span class="comment">//保存菜品的口味到dishFlavor中</span></span><br><span class="line">        dishFlavorService.saveBatch(dishDto.getFlavors());</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="12-3-菜品信息分页查询"><a href="#12-3-菜品信息分页查询" class="headerlink" title="12.3 菜品信息分页查询"></a>12.3 菜品信息分页查询</h4><p>需求分析</p>
<p><img src="/assets/Snipaste_2024-05-01_22-46-23-1715058981804-44.png"></p>
<p><img src="/assets/Snipaste_2024-05-01_22-47-23-1715058981804-45.png"></p>
<p>分页查询代码 </p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@GetMapping(&quot;/page&quot;)</span></span><br><span class="line"><span class="keyword">public</span> R&lt;Page&gt; <span class="title function_">page</span><span class="params">(<span class="type">int</span> page, <span class="type">int</span> pageSize, String name)</span> &#123;</span><br><span class="line">    <span class="comment">//构造分页构造器</span></span><br><span class="line">    <span class="type">Page</span> <span class="variable">pageInfo</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Page</span>(page, pageSize);</span><br><span class="line"></span><br><span class="line">    log.info(<span class="string">&quot;page:&#123;&#125;,pageSize:&#123;&#125;,index:&#123;&#125;&quot;</span>, page, pageSize, name);</span><br><span class="line">    <span class="comment">//构造条件查询</span></span><br><span class="line">    LambdaQueryWrapper&lt;Dish&gt; queryWrapper = <span class="keyword">new</span> <span class="title class_">LambdaQueryWrapper</span>&lt;&gt;();</span><br><span class="line">    queryWrapper.like(StringUtils.isNotEmpty(name), Dish::getName, name);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">//排序条件</span></span><br><span class="line">    queryWrapper.orderByDesc(Dish::getSort);</span><br><span class="line">    <span class="comment">//执行查询</span></span><br><span class="line">    dishService.page(pageInfo, queryWrapper);</span><br><span class="line">    <span class="comment">//返回值</span></span><br><span class="line">    <span class="keyword">return</span> R.success(pageInfo);</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="重点-不显示字段修改"><a href="#重点-不显示字段修改" class="headerlink" title="(重点)不显示字段修改"></a>(重点)不显示字段修改</h4><p>代码完善 菜品分类 </p>
<p>完整代码</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line">  <span class="meta">@GetMapping(&quot;/page&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> R&lt;Page&gt; <span class="title function_">page</span><span class="params">(<span class="type">int</span> page, <span class="type">int</span> pageSize, String name)</span> &#123;</span><br><span class="line">        <span class="comment">//构造分页构造器</span></span><br><span class="line">        Page&lt;Dish&gt; pageInfo = <span class="keyword">new</span> <span class="title class_">Page</span>(page, pageSize);</span><br><span class="line">        Page&lt;DishDto&gt; dishDtoPage = <span class="keyword">new</span> <span class="title class_">Page</span>(page, pageSize);</span><br><span class="line"></span><br><span class="line">        log.info(<span class="string">&quot;page:&#123;&#125;,pageSize:&#123;&#125;,index:&#123;&#125;&quot;</span>, page, pageSize, name);</span><br><span class="line">        <span class="comment">//构造条件查询</span></span><br><span class="line">        LambdaQueryWrapper&lt;Dish&gt; queryWrapper = <span class="keyword">new</span> <span class="title class_">LambdaQueryWrapper</span>&lt;&gt;();</span><br><span class="line">        queryWrapper.like(StringUtils.isNotEmpty(name), Dish::getName, name);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="comment">//排序条件</span></span><br><span class="line">        queryWrapper.orderByDesc(Dish::getSort);</span><br><span class="line">        <span class="comment">//执行查询</span></span><br><span class="line">        dishService.page(pageInfo, queryWrapper);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//对象拷贝</span></span><br><span class="line">        BeanUtils.copyProperties(pageInfo,dishDtoPage,<span class="string">&quot;records&quot;</span>);</span><br><span class="line"></span><br><span class="line">        List&lt;Dish&gt; records = pageInfo.getRecords();</span><br><span class="line"></span><br><span class="line"><span class="comment">//        List&lt;DishDto&gt; list =   records.stream().map((item)-&gt;&#123;</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//            DishDto dishDto = new DishDto();</span></span><br><span class="line"><span class="comment">//            BeanUtils.copyProperties(item,dishDto);</span></span><br><span class="line"><span class="comment">//            Category category = categoryService.getById(item.getCategoryId());</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//            dishDto.setCategoryName(category.getName());</span></span><br><span class="line"><span class="comment">//            return  dishDto;</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//        &#125;).collect(Collectors.toList());</span></span><br><span class="line"> 		List&lt;DishDto&gt; list = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        <span class="keyword">for</span> (Dish record : records) &#123;</span><br><span class="line">            <span class="type">DishDto</span> <span class="variable">dishDto</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DishDto</span>();</span><br><span class="line">            BeanUtils.copyProperties(record, dishDto);</span><br><span class="line"></span><br><span class="line">            <span class="type">Category</span> <span class="variable">category</span> <span class="operator">=</span> categoryService.getById(record.getCategoryId());</span><br><span class="line">            <span class="keyword">if</span> (category!=<span class="literal">null</span>)&#123;</span><br><span class="line">                dishDto.setCategoryName(category.getName());</span><br><span class="line">                list.add(dishDto);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">错误点 ,没有设置新的list接收</span><br><span class="line"><span class="comment">//        for (Dish record : records) &#123;0</span></span><br><span class="line"><span class="comment">//            DishDto dishDto = new DishDto();0</span></span><br><span class="line"><span class="comment">//            BeanUtils.copyProperties(record,dishDto);0</span></span><br><span class="line"><span class="comment">//            Long categoryId = record.getCategoryId();0</span></span><br><span class="line"><span class="comment">//            //根据id查询分类对象</span></span><br><span class="line"><span class="comment">//            Category category = categoryService.getById(categoryId);0</span></span><br><span class="line"><span class="comment">//            String categoryName = category.getName();0</span></span><br><span class="line"><span class="comment">//            dishDto.setCategoryName(categoryName);</span></span><br><span class="line"></span><br><span class="line">        dishDtoPage.setRecords(list);</span><br><span class="line">        <span class="comment">//返回值</span></span><br><span class="line">        <span class="keyword">return</span> R.success(dishDtoPage);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p>总结：将dishPage的records数据和查询到的数据库数据分别赋值给dishDto的records数据和查询到的数据库数据</p>
<h4 id="12-4修改菜品"><a href="#12-4修改菜品" class="headerlink" title="12.4修改菜品"></a>12.4修改菜品</h4><p><img src="/assets/Snipaste_2024-05-02_00-12-52-1715058981805-46.png"></p>
<p><strong>代码开发-梳理流程(4步)</strong></p>
<p>梳理一下修改菜品时前端页面(add.html)和服务端的交互过程：</p>
<p>1、页面发送×请求，请求服务端获取分类数据，用于菜品分类下拉框中数据展示;</p>
<p>12.2.4已做完</p>
<p>2、页面发送ajax请求，请求服务端，根据id查询当前菜品信息，用于菜品信息回显</p>
<p>DishController层</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@GetMapping(&quot;/&#123;ids&#125;&quot;)</span></span><br><span class="line"><span class="keyword">public</span> R&lt;DishDto&gt; <span class="title function_">getById</span><span class="params">(<span class="meta">@PathVariable</span>  Long ids)</span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="type">DishDto</span> <span class="variable">byIdWithFlavor</span> <span class="operator">=</span> dishService.getByIdWithFlavor(ids);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> R.success(byIdWithFlavor);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>service层(需要熟悉方法2 ,this)</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">  <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> DishDto <span class="title function_">getByIdWithFlavor</span><span class="params">(Long ids)</span> &#123;</span><br><span class="line">        <span class="type">DishDto</span> <span class="variable">dishDto</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DishDto</span>();</span><br><span class="line">        <span class="comment">//查询基本信息,</span></span><br><span class="line">        <span class="comment">//this.getById(id)==dishService.getById(id);</span></span><br><span class="line">        <span class="type">Dish</span> <span class="variable">dish</span> <span class="operator">=</span> <span class="built_in">this</span>.getById(ids);</span><br><span class="line">        BeanUtils.copyProperties(dish,dishDto);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//查询菜品口味</span></span><br><span class="line">        <span class="comment">//方法1</span></span><br><span class="line">        List&lt;DishFlavor&gt; dishFlavorsList = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        <span class="type">DishFlavor</span> <span class="variable">dishFlavor</span> <span class="operator">=</span> dishFlavorService.getById(ids);</span><br><span class="line">        dishFlavorsList.add(dishFlavor);</span><br><span class="line">        dishDto.setFlavors(dishFlavorsList);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//方法2</span></span><br><span class="line"><span class="comment">//        LambdaQueryWrapper&lt;DishFlavor&gt; dishLambdaQueryWrapper = new LambdaQueryWrapper&lt;&gt;();</span></span><br><span class="line"><span class="comment">//        dishLambdaQueryWrapper.eq(DishFlavor::getDishId,dish.getId());</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//        List&lt;DishFlavor&gt; list = dishFlavorService.list(dishLambdaQueryWrapper);</span></span><br><span class="line"><span class="comment">//        dishDto.setFlavors(list);</span></span><br><span class="line">        <span class="keyword">return</span> dishDto;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>



<p>3、页面发送请求，请求服务端进行图片下载，用于页图片回显</p>
<p>12.1已做完</p>
<p>4、点击保存按钮，页面发送ajx请求，将修改后的菜品相关数据以son形式提交到服务端</p>
<p>DishController层</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@PutMapping</span></span><br><span class="line"><span class="keyword">public</span> R&lt;String&gt; <span class="title function_">update</span><span class="params">(<span class="meta">@RequestBody</span> DishDto dishDto)</span>&#123;</span><br><span class="line">    dishService.updateWithFlavor(dishDto);</span><br><span class="line">    <span class="keyword">return</span> R.success(<span class="string">&quot;修改菜品成功&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>service层</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"> <span class="meta">@Override</span></span><br><span class="line">    <span class="meta">@Transactional</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">updateWithFlavor</span><span class="params">(DishDto dishDto)</span> &#123;</span><br><span class="line">        <span class="comment">//更新基本信息</span></span><br><span class="line">        <span class="built_in">this</span>.updateById(dishDto);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//清理当前来品对应口味数据--dish flavor表的delete操角</span></span><br><span class="line">        LambdaQueryWrapper&lt;DishFlavor&gt; dishFlavorLambdaQueryWrapper = <span class="keyword">new</span> <span class="title class_">LambdaQueryWrapper</span>&lt;&gt;();</span><br><span class="line">        dishFlavorLambdaQueryWrapper.eq(DishFlavor::getDishId, dishDto.getId());</span><br><span class="line">        dishFlavorService.removeById(dishDto.getId());</span><br><span class="line"></span><br><span class="line">        <span class="comment">//添加当前提交过来的口味数据---dish f1avor表的insert操作</span></span><br><span class="line">        List&lt;DishFlavor&gt; flavors = dishDto.getFlavors();</span><br><span class="line">        <span class="keyword">for</span> (DishFlavor flavor : flavors) &#123;</span><br><span class="line">            flavor.setDishId(dishDto.getId());</span><br><span class="line">        &#125;</span><br><span class="line"><span class="comment">//        flavors=  flavors.stream().map((item) -&gt;&#123;</span></span><br><span class="line"><span class="comment">//                item.setDishId(dishDto.getId());</span></span><br><span class="line"><span class="comment">//                return item;</span></span><br><span class="line"><span class="comment">//                &#125;).collect(Collectors.toList());</span></span><br><span class="line"></span><br><span class="line">        dishFlavorService.saveBatch(flavors);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p>开发修改菜品功能，其实就是在服务端编写代码去处理前端页面发送的这4次请求即可。</p>
<h4 id="12-5批量删除-细节看下"><a href="#12-5批量删除-细节看下" class="headerlink" title="12.5批量删除(细节看下)"></a>12.5批量删除(细节看下)</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">deleteDish</span><span class="params">(String ids)</span> &#123;</span><br><span class="line">    String[] split = ids.split(<span class="string">&quot;,&quot;</span>);</span><br><span class="line">    <span class="keyword">for</span> (String id : split) &#123;</span><br><span class="line">        <span class="comment">// 删除菜品</span></span><br><span class="line">       removeById(id);</span><br><span class="line">         <span class="comment">// 删除菜品对应口味信息</span></span><br><span class="line">        LambdaQueryWrapper&lt;DishFlavor&gt; dishFlavorLambdaQueryWrapper = <span class="keyword">new</span> <span class="title class_">LambdaQueryWrapper</span>&lt;&gt;();</span><br><span class="line">        dishFlavorLambdaQueryWrapper.eq(DishFlavor::getDishId,id);</span><br><span class="line">        dishFlavorService.remove(dishFlavorLambdaQueryWrapper);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="12-6批量起售停售-看下"><a href="#12-6批量起售停售-看下" class="headerlink" title="12.6批量起售停售(看下)"></a>12.6批量起售停售(看下)</h4><p>完整代码</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"> <span class="meta">@PostMapping(&quot;/status/&#123;status&#125;&quot;)</span>  </span><br><span class="line"><span class="keyword">public</span> R <span class="title function_">changeStatus</span><span class="params">(<span class="meta">@PathVariable</span> <span class="type">int</span> status,String ids)</span>&#123;</span><br><span class="line">        String[] idList = ids.split(<span class="string">&quot;,&quot;</span>);</span><br><span class="line">        <span class="keyword">for</span> (String id : idList) &#123;</span><br><span class="line">            <span class="type">Dish</span> <span class="variable">dish</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Dish</span>();</span><br><span class="line">            dish.setId(Long.parseLong(id));</span><br><span class="line">            dish.setStatus(status);</span><br><span class="line">            dishService.updateById(dish);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> R.success(<span class="string">&quot;更新状态成功&quot;</span>);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<img src="assets/Snipaste_2024-05-02_12-59-21-1715058981805-47.png" style="zoom:200%;" />

<h2 id="13-套餐管理"><a href="#13-套餐管理" class="headerlink" title="13.套餐管理"></a>13.套餐管理</h2><h3 id="13-1新增套餐"><a href="#13-1新增套餐" class="headerlink" title="13.1新增套餐"></a>13.1新增套餐</h3><p>需求分析</p>
<p><img src="/assets/Snipaste_2024-05-02_13-39-19-1715058981805-48.png"></p>
<p>将需要用到的类和接口基本结构创建好：</p>
<p>●实体类SetmealDish</p>
<p>●DTO SetmealDto</p>
<p>●Mapper接口SetmealDishMapper<br>●业务层接口SetmealDishService<br>●业务层实现类SetmealDishServicelmpl<br>●控制层SetmealController</p>
<hr>
<p>在开发代码之前，需要梳理一下新增套餐时前端页面和服务端的交互过程：<br>1、页面(backend&#x2F;page&#x2F;combo&#x2F;add.html)发送ajax请求，请求服务端获取套餐分类数据并展示到下拉框中</p>
<p><img src="/assets/Snipaste_2024-05-02_15-47-17-1715058981805-49.png"></p>
<p>2、页面发送ajax请求，请求服务端获取菜品分类数据并展示到添加菜品窗口中</p>
<p><img src="/assets/Snipaste_2024-05-02_15-51-40-1715058981805-50.png"></p>
<p>3、页面发送ajax请求，请求服务端，根据菜品分类查询对应的藁品数据并展示到</p>
<h4 id="添加菜品窗口中"><a href="#添加菜品窗口中" class="headerlink" title="添加菜品窗口中"></a>添加菜品窗口中</h4><p><img src="/assets/Snipaste_2024-05-02_15-53-04-1715058981805-52.png"></p>
<p>完整代码</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@GetMapping(&quot;/list&quot;)</span></span><br><span class="line"> <span class="keyword">public</span> R&lt;List&lt;Dish&gt;&gt; <span class="title function_">list</span><span class="params">(Dish dish)</span>&#123;</span><br><span class="line">     <span class="comment">//构造条件</span></span><br><span class="line">     LambdaQueryWrapper&lt;Dish&gt; dishLambdaQueryWrapper = <span class="keyword">new</span> <span class="title class_">LambdaQueryWrapper</span>&lt;&gt;();</span><br><span class="line">     dishLambdaQueryWrapper.eq(dish.getCategoryId()!=<span class="literal">null</span>,Dish::getCategoryId,dish.getCategoryId());</span><br><span class="line">     <span class="comment">//查询起售菜品</span></span><br><span class="line">     dishLambdaQueryWrapper.eq(Dish::getStatus,<span class="number">1</span>);</span><br><span class="line">     <span class="comment">//排序条件</span></span><br><span class="line"></span><br><span class="line">     dishLambdaQueryWrapper.orderByAsc(Dish::getSort);</span><br><span class="line">     dishLambdaQueryWrapper.orderByDesc(Dish::getUpdateTime);</span><br><span class="line"></span><br><span class="line">     List&lt;Dish&gt; list = dishService.list(dishLambdaQueryWrapper);</span><br><span class="line"></span><br><span class="line">     <span class="keyword">return</span> R.success(list);</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure>

<p>代码完善 - 停售产品 不可用</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//查询起售菜品</span></span><br><span class="line">        dishLambdaQueryWrapper.eq(Dish::getStatus,<span class="number">1</span>);</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>





<p>4、页面发送请求进行图片上传，请求服务端将图片保存到服务器</p>
<p>5、页面发送请求进行图片下载，将上传的图片进行回显</p>
<p><img src="/assets/Snipaste_2024-05-02_15-54-06-1715058981805-51.png"></p>
<p>6、点击保存按钮，发送ajax请求，将套餐相关数据以)son形式提交到服务端</p>
<p>6(重点)新增菜品-双表查询 </p>
<p>保存到菜品表和套餐表</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@PostMapping</span></span><br><span class="line"><span class="keyword">public</span> R&lt;String&gt; <span class="title function_">save</span><span class="params">(<span class="meta">@RequestBody</span> SetmealDto setmealDto)</span> &#123;</span><br><span class="line">    setmealService.saveWithDish(setmealDto);</span><br><span class="line">    <span class="keyword">return</span> R.success(<span class="string">&quot;套餐保存成功&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>service中</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SetmealServicelmpl</span> <span class="keyword">extends</span> <span class="title class_">ServiceImpl</span>&lt;SetmealMapper, Setmeal&gt; <span class="keyword">implements</span> <span class="title class_">SetmealService</span> &#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> SetmealDishService setmealDishService;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//新增套餐，同时需要保存套餐和菜品的为联关系</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="meta">@Transactional</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">saveWithDish</span><span class="params">(SetmealDto setmealDto)</span> &#123;</span><br><span class="line">        <span class="comment">//保存套餐的基本信息到setmeal中</span></span><br><span class="line">        <span class="built_in">this</span>.save(setmealDto);</span><br><span class="line">        <span class="comment">//  获取对应list</span></span><br><span class="line">        List&lt;SetmealDish&gt; setmealDishes = setmealDto.getSetmealDishes();</span><br><span class="line">        <span class="comment">//添加setmealId</span></span><br><span class="line">        setmealDishes.stream().map((item) -&gt; &#123;</span><br><span class="line">            item.setSetmealId(setmealDto.getId());</span><br><span class="line">            <span class="keyword">return</span> item;</span><br><span class="line"></span><br><span class="line">        &#125;).collect(Collectors.toList());</span><br><span class="line"></span><br><span class="line">        <span class="comment">//获得套餐和菜品的管理信息</span></span><br><span class="line">        setmealDishService.saveBatch(setmealDishes);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>





<p>开发新增套餐功能，其实就是在服务端编写代码去处理前端页面发送的这6次请求即可。</p>
<h3 id="13-2套餐信息分页查询"><a href="#13-2套餐信息分页查询" class="headerlink" title="13.2套餐信息分页查询"></a>13.2套餐信息分页查询</h3><p>代码开发-梳理交互过程</p>
<p>在开发代码之前，需要梳理一下套餐分页查询时前端页面和服务端的交互过程：</p>
<p>1、页面(backend&#x2F;page&#x2F;combo&#x2F;list.html)发送ajax请求，将分页查询参数(page、pageSize、<br>name)提交到服务端，获取分页数据</p>
<p>2、页面发送请求，请求服务端进行图片下载，用于页面图片展示</p>
<p>代码</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@GetMapping(&quot;/page&quot;)</span></span><br><span class="line"><span class="keyword">public</span> R&lt;Page&gt; <span class="title function_">page</span><span class="params">(<span class="type">int</span> page, <span class="type">int</span> pageSize, String name)</span> &#123;</span><br><span class="line"></span><br><span class="line">    Page&lt;Setmeal&gt; setmealPage = <span class="keyword">new</span> <span class="title class_">Page</span>&lt;&gt;(page,pageSize);</span><br><span class="line"></span><br><span class="line">    LambdaQueryWrapper&lt;Setmeal&gt; setmealLambdaQueryWrapper = <span class="keyword">new</span> <span class="title class_">LambdaQueryWrapper</span>&lt;&gt;();</span><br><span class="line">    setmealLambdaQueryWrapper.like(StringUtils.isNotEmpty(name), Setmeal::getName, name);</span><br><span class="line">    setmealLambdaQueryWrapper.orderByDesc(Setmeal::getUpdateTime);</span><br><span class="line">    setmealService.page(setmealPage, setmealLambdaQueryWrapper);</span><br><span class="line">    <span class="keyword">return</span> R.success(setmealPage);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h5 id="重点-套餐分类不显示"><a href="#重点-套餐分类不显示" class="headerlink" title="(重点)套餐分类不显示"></a>(重点)套餐分类不显示</h5><p> 代码完善 </p>
<p>-分页查询返回数据为1,2(数据不满足)</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Autowired</span></span><br><span class="line"><span class="keyword">private</span> CategoryService categoryService;</span><br><span class="line"><span class="meta">@GetMapping(&quot;/page&quot;)</span></span><br><span class="line"><span class="keyword">public</span> R&lt;Page&gt; <span class="title function_">page</span><span class="params">(<span class="type">int</span> page, <span class="type">int</span> pageSize, String name)</span> &#123;</span><br><span class="line">    <span class="comment">//分页构造器</span></span><br><span class="line">    Page&lt;Setmeal&gt; setmealPage = <span class="keyword">new</span> <span class="title class_">Page</span>&lt;&gt;(page, pageSize);</span><br><span class="line">    Page&lt;SetmealDto&gt; setmealDtoPage = <span class="keyword">new</span> <span class="title class_">Page</span>&lt;&gt;(page, pageSize);</span><br><span class="line"></span><br><span class="line">	<span class="comment">//条件构造器</span></span><br><span class="line">    LambdaQueryWrapper&lt;Setmeal&gt; setmealLambdaQueryWrapper = <span class="keyword">new</span> <span class="title class_">LambdaQueryWrapper</span>&lt;&gt;();</span><br><span class="line">    <span class="comment">//构造搜索条件</span></span><br><span class="line">    setmealLambdaQueryWrapper.like(StringUtils.isNotEmpty(name), Setmeal::getName, name);</span><br><span class="line">    <span class="comment">//构造排序</span></span><br><span class="line">    setmealLambdaQueryWrapper.orderByDesc(Setmeal::getUpdateTime);</span><br><span class="line">	<span class="comment">//分装</span></span><br><span class="line">    setmealService.page(setmealPage, setmealLambdaQueryWrapper);</span><br><span class="line">	<span class="comment">//复制普通  &lt;页面&gt;   属性,除 &quot;records&quot;</span></span><br><span class="line">    BeanUtils.copyProperties(setmealPage, setmealDtoPage, <span class="string">&quot;records&quot;</span>);</span><br><span class="line">	<span class="comment">//单独获取 &quot;records&quot;字段 ,字段为1,2需要从dto中获取,对应字符</span></span><br><span class="line">    List&lt;Setmeal&gt; records = setmealPage.getRecords();</span><br><span class="line">    <span class="comment">//遍历 get,set</span></span><br><span class="line">    List&lt;SetmealDto&gt; list = records.stream().map((item) -&gt; &#123;</span><br><span class="line">        <span class="type">SetmealDto</span> <span class="variable">setmealDto</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SetmealDto</span>();</span><br><span class="line">        <span class="comment">//复制 &lt;实体&gt; 属性</span></span><br><span class="line">        BeanUtils.copyProperties(item, setmealDto);</span><br><span class="line">        <span class="comment">//分类id</span></span><br><span class="line">        <span class="type">Long</span> <span class="variable">categoryId</span> <span class="operator">=</span> item.getCategoryId();</span><br><span class="line">        <span class="comment">//根据分类id查询分类对象</span></span><br><span class="line">        <span class="type">Category</span> <span class="variable">category</span> <span class="operator">=</span> categoryService.getById(categoryId);</span><br><span class="line">        <span class="keyword">if</span> (category != <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="comment">//分类名称</span></span><br><span class="line">            <span class="type">String</span> <span class="variable">categoryName</span> <span class="operator">=</span> category.getName();</span><br><span class="line">            setmealDto.setCategoryName(categoryName);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> setmealDto;</span><br><span class="line">    &#125;).collect(Collectors.toList());</span><br><span class="line"></span><br><span class="line">    setmealDtoPage.setRecords(list);</span><br><span class="line">    <span class="keyword">return</span> R.success(setmealDtoPage);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>





<h3 id="13-3删除套餐"><a href="#13-3删除套餐" class="headerlink" title="13.3删除套餐"></a>13.3删除套餐</h3><p>需求分析</p>
<p><img src="/assets/Snipaste_2024-05-02_19-04-29-1715058981805-53.png"></p>
<p><img src="/assets/Snipaste_2024-05-02_20-13-40-1715058981805-54.png"></p>
<p>list</p>
<p><img src="/assets/Snipaste_2024-05-02_20-22-31-1715058981805-55.png"></p>
<p><img src="/assets/Snipaste_2024-05-02_20-40-26-1715058981805-56.png"></p>
<p><img src="/assets/Snipaste_2024-05-02_20-40-39-1715058981805-57.png"></p>
<p>完整代码</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"> <span class="meta">@Transactional</span></span><br><span class="line">    <span class="meta">@DeleteMapping</span></span><br><span class="line"><span class="comment">//    public R&lt;String&gt; delete(@RequestParam List&lt;Long&gt; ids) &#123;</span></span><br><span class="line">    <span class="keyword">public</span> R&lt;String&gt; <span class="title function_">delete</span><span class="params">(String ids)</span> &#123;</span><br><span class="line">        String[] split = ids.split(<span class="string">&quot;,&quot;</span>);</span><br><span class="line">        <span class="keyword">for</span> (String setmealId : split) &#123;</span><br><span class="line">            <span class="comment">//判断套餐是否起售</span></span><br><span class="line">            <span class="keyword">if</span> (setmealService.getById(setmealId).getStatus() != <span class="number">1</span>) &#123;</span><br><span class="line">                <span class="comment">//删除本类字条</span></span><br><span class="line">                setmealService.removeById(setmealId);</span><br><span class="line">                <span class="comment">//构造条件,锁定,对应表格</span></span><br><span class="line">                LambdaQueryWrapper&lt;SetmealDish&gt; setmealDishLambdaQueryWrapper = <span class="keyword">new</span> <span class="title class_">LambdaQueryWrapper</span>&lt;&gt;();</span><br><span class="line">                setmealDishLambdaQueryWrapper.eq(SetmealDish::getSetmealId, setmealId);</span><br><span class="line">                setmealDishService.remove(setmealDishLambdaQueryWrapper);</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">CustomException</span>(<span class="string">&quot;套餐正在售卖中&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> R.success(<span class="string">&quot;删除成功&quot;</span>);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p>13.4批量 停售起售</p>
<p> 方案1,string 切割</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@PostMapping(&quot;/status/&#123;status&#125;&quot;)</span></span><br><span class="line"><span class="keyword">public</span> R&lt;String&gt; <span class="title function_">update</span><span class="params">(<span class="meta">@PathVariable</span> <span class="type">int</span> status, String ids)</span> &#123;</span><br><span class="line"> </span><br><span class="line">   <span class="comment">//获得ids对应的,套餐</span></span><br><span class="line">   String[] split = ids.split(<span class="string">&quot;,&quot;</span>);</span><br><span class="line">      <span class="keyword">for</span> (String id : split) &#123;</span><br><span class="line">     <span class="comment">//设置 套餐 setmeal.status字段为 指定 status</span></span><br><span class="line">          <span class="type">Setmeal</span> <span class="variable">setmeal</span> <span class="operator">=</span> setmealService.getById(id);</span><br><span class="line">          setmeal.setStatus(status);</span><br><span class="line">          <span class="comment">//执行</span></span><br><span class="line">          setmealService.updateById(setmeal);</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">return</span> R.success(<span class="string">&quot;修改成功&quot;</span>);</span><br><span class="line"></span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>

<p>方案2 list</p>
<p>&#x2F;&#x2F;设置 套餐 setmeal.status字段为 指定 status</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@PostMapping(&quot;/status/&#123;status&#125;&quot;)</span></span><br><span class="line"> <span class="keyword">public</span> R&lt;String&gt; <span class="title function_">update</span><span class="params">(<span class="meta">@PathVariable</span> <span class="type">int</span> status, <span class="meta">@RequestParam</span> List&lt;Long&gt; ids)</span> &#123;</span><br><span class="line">     <span class="keyword">for</span> (Long id : ids) &#123;</span><br><span class="line">         <span class="type">Setmeal</span> <span class="variable">setmeal</span> <span class="operator">=</span> setmealService.getById(id);</span><br><span class="line">         setmeal.setStatus(status);</span><br><span class="line">         <span class="comment">//执行</span></span><br><span class="line">         setmealService.updateById(setmeal);</span><br><span class="line">     &#125;</span><br><span class="line">     <span class="keyword">return</span> R.success(<span class="string">&quot;修改成功&quot;</span>);</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure>

<h2 id="14-手机验证登陆"><a href="#14-手机验证登陆" class="headerlink" title="14.手机验证登陆"></a>14.手机验证登陆</h2><h3 id="14-1短信发送"><a href="#14-1短信发送" class="headerlink" title="14.1短信发送"></a>14.1短信发送</h3><h4 id="短信服务介绍"><a href="#短信服务介绍" class="headerlink" title="短信服务介绍"></a>短信服务介绍</h4><p><img src="/assets/Snipaste_2024-05-02_23-18-33-1715058981805-58.png"></p>
<h4 id="阿里云短信服务"><a href="#阿里云短信服务" class="headerlink" title="阿里云短信服务"></a>阿里云短信服务</h4><p><img src="/assets/Snipaste_2024-05-02_23-20-54-1715058981805-59.png"></p>
<h4 id="代码开发-1"><a href="#代码开发-1" class="headerlink" title="代码开发"></a>代码开发</h4><p>导入maven坐标</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&lt;dependency&gt;</span><br><span class="line">&lt;groupId&gt;com.aliyun&lt;/groupId&gt;</span><br><span class="line">&lt;artifactId&gt;aliyun-java-sdk-core&lt;/artifactId&gt;</span><br><span class="line">&lt;version&gt;4.5.16&lt;/version&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br><span class="line">&lt;dependency&gt;</span><br><span class="line">&lt;groupId&gt;com.aliyun&lt;/groupId&gt;</span><br><span class="line">&lt;artifactId&gt;aliyun-java-sdk-dysmsapi&lt;/artifactId&gt;</span><br><span class="line">&lt;version&gt;2.1.0&lt;/version&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br></pre></td></tr></table></figure>



<p>调用API</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> cn.itheima.reggie.utils;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">sendMessage</span><span class="params">(String signName, String templateCode,String phoneNumbers,String param)</span>&#123;</span><br><span class="line">		<span class="type">DefaultProfile</span> <span class="variable">profile</span> <span class="operator">=</span> DefaultProfile.getProfile(<span class="string">&quot;cn-hangzhou&quot;</span>, <span class="string">&quot;&quot;</span>, <span class="string">&quot;&quot;</span>);</span><br><span class="line">		<span class="type">IAcsClient</span> <span class="variable">client</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DefaultAcsClient</span>(profile);</span><br><span class="line"></span><br><span class="line">		<span class="type">SendSmsRequest</span> <span class="variable">request</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SendSmsRequest</span>();</span><br><span class="line">		request.setSysRegionId(<span class="string">&quot;cn-hangzhou&quot;</span>);</span><br><span class="line">		request.setPhoneNumbers(phoneNumbers);</span><br><span class="line">		request.setSignName(signName);</span><br><span class="line">		request.setTemplateCode(templateCode);</span><br><span class="line">		request.setTemplateParam(<span class="string">&quot;&#123;\&quot;code\&quot;:\&quot;&quot;</span>+param+<span class="string">&quot;\&quot;&#125;&quot;</span>);</span><br><span class="line">		<span class="keyword">try</span> &#123;</span><br><span class="line">			<span class="type">SendSmsResponse</span> <span class="variable">response</span> <span class="operator">=</span> client.getAcsResponse(request);</span><br><span class="line">			System.out.println(<span class="string">&quot;短信发送成功&quot;</span>);</span><br><span class="line">		&#125;<span class="keyword">catch</span> (ClientException e) &#123;</span><br><span class="line">			e.printStackTrace();</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>





<h3 id="14-2手机验证码登陆"><a href="#14-2手机验证码登陆" class="headerlink" title="14.2手机验证码登陆"></a>14.2手机验证码登陆</h3><p>需求分析</p>
<p><img src="/assets/Snipaste_2024-05-02_23-59-57-1715058981805-60.png"></p>
<p>代码开发-准备工作<br>在开发业务功能前，先将需要用到的类和接口基本结构创建好：<br>●实体类User(直接从课程资料中导入即可】<br>●Mapper接▣UserMapper<br>●业务层接▣UserService<br>●业务层实现类UserServicelmpl<br>●控制层UserController</p>
<h5 id="针对移动端用户-拦截器"><a href="#针对移动端用户-拦截器" class="headerlink" title="针对移动端用户-拦截器"></a>针对移动端用户-拦截器</h5><p><img src="/assets/Snipaste_2024-05-03_12-57-21-1715058981805-61.png"></p>
<p>●工具类SMSUtils、ValidateCodeUtils(直接从课程资料中导入即可)</p>
<h6 id="HttpSession"><a href="#HttpSession" class="headerlink" title="HttpSession"></a><code>HttpSession</code></h6><p><code>HttpSession</code> 是 Java Servlet API 中的一个接口，用于在客户端和服务器之间跟踪会话状态。它提供了一种在多个 HTTP 请求之间存储用户信息的机制，并且可以通过一个唯一的会话 ID 来识别每个用户的会话。</p>
<p>要使用 <code>HttpSession</code>，你需要通过 <code>HttpServletRequest</code> 对象获取它。以下是一个简单的示例，演示了如何在 Servlet 中使用 <code>HttpSession</code>：</p>
<p>与项目无关-</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> javax.servlet.http.*;</span><br><span class="line"></span><br><span class="line"><span class="meta">@WebServlet(&quot;/example&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ExampleServlet</span> <span class="keyword">extends</span> <span class="title class_">HttpServlet</span> &#123;</span><br><span class="line"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">doGet</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> &#123;</span><br><span class="line">    <span class="comment">// 获取 HttpSession 对象，如果不存在则创建新的会话</span></span><br><span class="line">    <span class="type">HttpSession</span> <span class="variable">session</span> <span class="operator">=</span> request.getSession();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 在会话中存储数据</span></span><br><span class="line">    session.setAttribute(<span class="string">&quot;username&quot;</span>, <span class="string">&quot;John&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 从会话中获取数据</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">username</span> <span class="operator">=</span> (String) session.getAttribute(<span class="string">&quot;username&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 删除会话中的数据</span></span><br><span class="line">    session.removeAttribute(<span class="string">&quot;username&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 设置会话失效时间（以秒为单位）</span></span><br><span class="line">    session.setMaxInactiveInterval(<span class="number">3600</span>); <span class="comment">// 1 hour</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 使会话失效（立即删除会话）</span></span><br><span class="line">    session.invalidate();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>}</p>
<h4 id="手机验证登陆"><a href="#手机验证登陆" class="headerlink" title="手机验证登陆"></a>手机验证登陆</h4><p>登陆代码</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> cn.itheima.reggie.controller;</span><br><span class="line"></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/user&quot;)</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserController</span> &#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> UserService userService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@PostMapping(&quot;/sendMsg&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> R&lt;String&gt; <span class="title function_">sendMsg</span><span class="params">(<span class="meta">@RequestBody</span> User user, HttpSession session)</span> &#123;</span><br><span class="line">        <span class="comment">//获取手机号</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">phone</span> <span class="operator">=</span> user.getPhone();</span><br><span class="line">        <span class="comment">//生成随机的验证码</span></span><br><span class="line">        <span class="keyword">if</span> (StringUtils.isNotEmpty(phone)) &#123;</span><br><span class="line">            <span class="type">String</span> <span class="variable">code</span> <span class="operator">=</span> ValidateCodeUtils.generateValidateCode(<span class="number">4</span>).toString();</span><br><span class="line">            log.info(<span class="string">&quot;code:&#123;&#125;&quot;</span>, code);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">            <span class="comment">//调用阿里云提供的短信api完成短信发送</span></span><br><span class="line"><span class="comment">//        SMSUtils.sendMessage(&quot;瑞吉外卖&quot;,&quot;&quot;,phone,code);</span></span><br><span class="line"></span><br><span class="line">            <span class="comment">//需要将生成的验证码保存到Session</span></span><br><span class="line">            session.setAttribute(phone, code);</span><br><span class="line">            R.success(<span class="string">&quot;手机验证码发送成功&quot;</span>);</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> R.error(<span class="string">&quot;手机验证码发送失败&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="15-用户登陆"><a href="#15-用户登陆" class="headerlink" title="15.用户登陆"></a>15.用户登陆</h2><h3 id="登陆代码-陌生"><a href="#登陆代码-陌生" class="headerlink" title="登陆代码(陌生)"></a>登陆代码(陌生)</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> cn.itheima.reggie.controller;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@PostMapping(&quot;/login&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> R&lt;User&gt; <span class="title function_">login</span><span class="params">(<span class="meta">@RequestBody</span> Map map, HttpSession session)</span> &#123;</span><br><span class="line"></span><br><span class="line">        log.info(map.toString());</span><br><span class="line"></span><br><span class="line">        <span class="comment">//获取手机号</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">phone</span> <span class="operator">=</span> map.get(<span class="string">&quot;phone&quot;</span>).toString();</span><br><span class="line">        <span class="comment">//获取验证码</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">code</span> <span class="operator">=</span> map.get(<span class="string">&quot;code&quot;</span>).toString();</span><br><span class="line">        <span class="comment">//从session中获取保存的验证码</span></span><br><span class="line">        <span class="type">Object</span> <span class="variable">codeSession</span> <span class="operator">=</span> session.getAttribute(phone);</span><br><span class="line">        <span class="keyword">if</span> (codeSession != <span class="literal">null</span> &amp;&amp; codeSession.equals(code)) &#123;</span><br><span class="line">            <span class="comment">//如果比对成功,说明登陆成功</span></span><br><span class="line">            LambdaQueryWrapper&lt;User&gt; userLambdaQueryWrapper = <span class="keyword">new</span> <span class="title class_">LambdaQueryWrapper</span>&lt;&gt;();</span><br><span class="line">            userLambdaQueryWrapper.eq(User::getPhone, phone);</span><br><span class="line">            <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> userService.getOne(userLambdaQueryWrapper);</span><br><span class="line">            <span class="comment">//判断手机号是否是新用户,如果是自动完成注册(保存数据)</span></span><br><span class="line">            <span class="keyword">if</span> (user == <span class="literal">null</span>) &#123;</span><br><span class="line">                user = <span class="keyword">new</span> <span class="title class_">User</span>();</span><br><span class="line">                user.setPhone(phone);</span><br><span class="line">                user.setStatus(<span class="number">1</span>);</span><br><span class="line">                userService.save(user);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> R.success(user);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> R.error(<span class="string">&quot;登陆失败&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="16-手机端-菜品展示"><a href="#16-手机端-菜品展示" class="headerlink" title="16.手机端 菜品展示"></a>16.手机端 菜品展示</h2><p><img src="/assets/Snipaste_2024-05-03_17-45-56-1715058981805-62.png"></p>
<h3 id="导入用户地址簿相关功能代码。"><a href="#导入用户地址簿相关功能代码。" class="headerlink" title="导入用户地址簿相关功能代码。"></a>导入用户地址簿相关功能代码。</h3><p>需求分析</p>
<p><img src="/assets/Snipaste_2024-05-03_18-25-10-1715058981805-63.png">数据模型</p>
<p>label-(标签,公司,家,等)</p>
<p><img src="/assets/Snipaste_2024-05-03_18-26-16-1715058981805-64.png"></p>
<p>导入功能代码</p>
<p>实体类AddressBook(直接从课程资料中导入即可)<br>Mapper接口AddressBookMapper<br>业务层接口AddressBookService<br>业务层实现类AddressBookServicelmpl<br>控制层AddressBookController(直接从课程资料中导入即可)</p>
<h4 id="新增地址-陌生"><a href="#新增地址-陌生" class="headerlink" title="新增地址(陌生)"></a>新增地址(陌生)</h4><p>登陆成功后可以通过这个方法获得id</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">BaseContext.getCurrentId());</span><br></pre></td></tr></table></figure>

<p>为什么不从Session里拿？Session每次拿还得传参数，还得写方法拿，这里直接用一个请求一个线程设置一个session值，拿的时候写这么点个方法就能拿到了.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Autowired</span></span><br><span class="line"><span class="keyword">private</span> AddressBookService addressBookService;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 新增</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@PostMapping</span></span><br><span class="line"><span class="keyword">public</span> R&lt;AddressBook&gt; <span class="title function_">save</span><span class="params">(<span class="meta">@RequestBody</span> AddressBook addressBook)</span> &#123;</span><br><span class="line">    addressBook.setUserId(BaseContext.getCurrentId());</span><br><span class="line">    log.info(<span class="string">&quot;addressBook:&#123;&#125;&quot;</span>, addressBook);</span><br><span class="line">    addressBookService.save(addressBook);</span><br><span class="line">    <span class="keyword">return</span> R.success(addressBook);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="设置默认地址"><a href="#设置默认地址" class="headerlink" title="设置默认地址"></a>设置默认地址</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@PutMapping(&quot;default&quot;)</span></span><br><span class="line"><span class="keyword">public</span> R&lt;AddressBook&gt; <span class="title function_">setDefault</span><span class="params">(<span class="meta">@RequestBody</span> AddressBook addressBook)</span> &#123;</span><br><span class="line">    log.info(<span class="string">&quot;addressBook:&#123;&#125;&quot;</span>, addressBook);</span><br><span class="line">    LambdaUpdateWrapper&lt;AddressBook&gt; wrapper = <span class="keyword">new</span> <span class="title class_">LambdaUpdateWrapper</span>&lt;&gt;();</span><br><span class="line">    wrapper.eq(AddressBook::getUserId, BaseContext.getCurrentId());</span><br><span class="line">    wrapper.set(AddressBook::getIsDefault, <span class="number">0</span>);</span><br><span class="line">    <span class="comment">//SQL:update address_book set is_default = 0 where user_id = ?</span></span><br><span class="line">    addressBookService.update(wrapper);</span><br><span class="line"></span><br><span class="line">    addressBook.setIsDefault(<span class="number">1</span>);</span><br><span class="line">    <span class="comment">//SQL:update address_book set is_default = 1 where id = ?</span></span><br><span class="line">    addressBookService.updateById(addressBook);</span><br><span class="line">    <span class="keyword">return</span> R.success(addressBook);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="根据id查询地址"><a href="#根据id查询地址" class="headerlink" title="根据id查询地址"></a>根据id查询地址</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 根据id查询地址</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@GetMapping(&quot;/&#123;id&#125;&quot;)</span></span><br><span class="line"><span class="keyword">public</span> R <span class="title function_">get</span><span class="params">(<span class="meta">@PathVariable</span> Long id)</span> &#123;</span><br><span class="line">    <span class="type">AddressBook</span> <span class="variable">addressBook</span> <span class="operator">=</span> addressBookService.getById(id);</span><br><span class="line">    <span class="keyword">if</span> (addressBook != <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> R.success(addressBook);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> R.error(<span class="string">&quot;没有找到该对象&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h4 id="查询默认地址"><a href="#查询默认地址" class="headerlink" title="查询默认地址"></a>查询默认地址</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 查询默认地址</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@GetMapping(&quot;default&quot;)</span></span><br><span class="line"><span class="keyword">public</span> R&lt;AddressBook&gt; <span class="title function_">getDefault</span><span class="params">()</span> &#123;</span><br><span class="line">    LambdaQueryWrapper&lt;AddressBook&gt; queryWrapper = <span class="keyword">new</span> <span class="title class_">LambdaQueryWrapper</span>&lt;&gt;();</span><br><span class="line">    queryWrapper.eq(AddressBook::getUserId, BaseContext.getCurrentId());</span><br><span class="line">    queryWrapper.eq(AddressBook::getIsDefault, <span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//SQL:select * from address_book where user_id = ? and is_default = 1</span></span><br><span class="line">    <span class="type">AddressBook</span> <span class="variable">addressBook</span> <span class="operator">=</span> addressBookService.getOne(queryWrapper);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (<span class="literal">null</span> == addressBook) &#123;</span><br><span class="line">        <span class="keyword">return</span> R.error(<span class="string">&quot;没有找到该对象&quot;</span>);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> R.success(addressBook);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h4 id="查询指定用户的全部地址"><a href="#查询指定用户的全部地址" class="headerlink" title="查询指定用户的全部地址"></a>查询指定用户的全部地址</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 查询指定用户的全部地址</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@GetMapping(&quot;/list&quot;)</span></span><br><span class="line"><span class="keyword">public</span> R&lt;List&lt;AddressBook&gt;&gt; <span class="title function_">list</span><span class="params">(AddressBook addressBook)</span> &#123;</span><br><span class="line">    addressBook.setUserId(BaseContext.getCurrentId());</span><br><span class="line">    log.info(<span class="string">&quot;addressBook:&#123;&#125;&quot;</span>, addressBook);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//条件构造器</span></span><br><span class="line">    LambdaQueryWrapper&lt;AddressBook&gt; queryWrapper = <span class="keyword">new</span> <span class="title class_">LambdaQueryWrapper</span>&lt;&gt;();</span><br><span class="line">    queryWrapper.eq(<span class="literal">null</span> != addressBook.getUserId(), AddressBook::getUserId, addressBook.getUserId());</span><br><span class="line">    queryWrapper.orderByDesc(AddressBook::getUpdateTime);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//SQL:select * from address_book where user_id = ? order by update_time desc</span></span><br><span class="line">    <span class="keyword">return</span> R.success(addressBookService.list(queryWrapper));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>功能测试</p>
<h3 id="菜品展示"><a href="#菜品展示" class="headerlink" title="菜品展示"></a>菜品展示</h3><p><img src="/assets/Snipaste_2024-05-03_19-02-55-1715058981805-66.png"></p>
<p>代码开发</p>
<p><img src="/assets/Snipaste_2024-05-03_19-05-38-1715058981805-65.png"></p>
<h4 id="1页面加载获取分类数据"><a href="#1页面加载获取分类数据" class="headerlink" title="1页面加载获取分类数据"></a>1页面加载获取分类数据</h4><p>请求已发送,但是接收不到原因 </p>
<p><img src="/assets/Snipaste_2024-05-03_19-08-44-1715058981805-67.png"></p>
<p>.all()把两个请求包起来，说明要全部成功才算成功</p>
<p><img src="/assets/Snipaste_2024-05-03_19-09-58-1715058981805-68.png"></p>
<h5 id="改造dish-Dto"><a href="#改造dish-Dto" class="headerlink" title="改造dish Dto"></a>改造dish Dto</h5><p><img src="/assets/Snipaste_2024-05-03_19-32-05-1715058981805-69.png"></p>
<p>原始代码</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@GetMapping(&quot;/list&quot;)</span></span><br><span class="line"><span class="keyword">public</span> R&lt;List&lt;Dish&gt;&gt; <span class="title function_">list</span><span class="params">(Dish dish)</span>&#123;</span><br><span class="line">    <span class="comment">//构造条件</span></span><br><span class="line">    LambdaQueryWrapper&lt;Dish&gt; dishLambdaQueryWrapper = <span class="keyword">new</span> <span class="title class_">LambdaQueryWrapper</span>&lt;&gt;();</span><br><span class="line">    dishLambdaQueryWrapper.eq(dish.getCategoryId()!=<span class="literal">null</span>,Dish::getCategoryId,dish.getCategoryId());</span><br><span class="line">    <span class="comment">//查询起售菜品</span></span><br><span class="line">    dishLambdaQueryWrapper.eq(Dish::getStatus,<span class="number">1</span>);</span><br><span class="line">    <span class="comment">//排序条件</span></span><br><span class="line">    dishLambdaQueryWrapper.orderByAsc(Dish::getSort);</span><br><span class="line">    dishLambdaQueryWrapper.orderByDesc(Dish::getUpdateTime);</span><br><span class="line"></span><br><span class="line">    List&lt;Dish&gt; list = dishService.list(dishLambdaQueryWrapper);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> R.success(list);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>1.新建DishDta对象；</p>
<p>2.拷贝dish到dishDto</p>
<p>3.获取id(dishId)；</p>
<p>4.根据dishId查口味</p>
<p>改造后  dish.getCategoryId() !&#x3D; null这句不判断页面不显示???</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@GetMapping(&quot;/list&quot;)</span></span><br><span class="line"><span class="keyword">public</span> R&lt;List&lt;DishDto&gt;&gt; <span class="title function_">list</span><span class="params">(DishDto dishDto)</span> &#123;</span><br><span class="line">    <span class="type">Dish</span> <span class="variable">dish</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Dish</span>();</span><br><span class="line">    <span class="comment">//构造条件</span></span><br><span class="line">    LambdaQueryWrapper&lt;Dish&gt; dishLambdaQueryWrapper = <span class="keyword">new</span> <span class="title class_">LambdaQueryWrapper</span>&lt;&gt;();</span><br><span class="line">    dishLambdaQueryWrapper.eq(dish.getCategoryId() != <span class="literal">null</span>, Dish::getCategoryId, dish.getCategoryId());</span><br><span class="line">    <span class="comment">//查询起售菜品</span></span><br><span class="line">    dishLambdaQueryWrapper.eq(Dish::getStatus, <span class="number">1</span>);</span><br><span class="line">    <span class="comment">//排序条件</span></span><br><span class="line">    dishLambdaQueryWrapper.orderByAsc(Dish::getSort);</span><br><span class="line">    dishLambdaQueryWrapper.orderByDesc(Dish::getUpdateTime);</span><br><span class="line"></span><br><span class="line">    List&lt;Dish&gt; list = dishService.list(dishLambdaQueryWrapper);</span><br><span class="line">    List&lt;DishDto&gt; dishDtoList = list.stream().map((item) -&gt; &#123;</span><br><span class="line">			<span class="type">DishDto</span> <span class="variable">dishDto</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DishDto</span>();</span><br><span class="line">        BeanUtils.copyProperties(item, dishDto);</span><br><span class="line">        <span class="type">Category</span> <span class="variable">category</span> <span class="operator">=</span> categoryService.getById(item.getCategoryId());</span><br><span class="line">        </span><br><span class="line">        <span class="comment">//当前菜品id</span></span><br><span class="line">        <span class="type">Long</span> <span class="variable">id</span> <span class="operator">=</span> item.getId();</span><br><span class="line">        LambdaQueryWrapper&lt;DishFlavor&gt; dishFlavorLambdaQueryWrapper = <span class="keyword">new</span> <span class="title class_">LambdaQueryWrapper</span>&lt;&gt;();</span><br><span class="line">        dishFlavorLambdaQueryWrapper.eq(DishFlavor::getDishId, id);</span><br><span class="line">        List&lt;DishFlavor&gt; list1 = dishFlavorService.list(dishFlavorLambdaQueryWrapper);</span><br><span class="line"></span><br><span class="line">        dishDto.setFlavors(list1);</span><br><span class="line">        dishDto.setCategoryName(category.getName());</span><br><span class="line">        <span class="keyword">return</span> dishDto;</span><br><span class="line"></span><br><span class="line">    &#125;).collect(Collectors.toList());</span><br><span class="line">    <span class="keyword">return</span> R.success(dishDtoList);</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="套餐开发-回显"><a href="#套餐开发-回显" class="headerlink" title="套餐开发-回显"></a>套餐开发-回显</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@GetMapping(&quot;/list&quot;)</span></span><br><span class="line"><span class="keyword">public</span> R&lt;List&lt;Setmeal&gt;&gt; <span class="title function_">list</span><span class="params">(Setmeal setmeal)</span>&#123;</span><br><span class="line">    LambdaQueryWrapper&lt;Setmeal&gt; setmealDtoLambdaQueryWrapper = <span class="keyword">new</span> <span class="title class_">LambdaQueryWrapper</span>&lt;&gt;();</span><br><span class="line">    setmealDtoLambdaQueryWrapper.eq(setmeal.getCategoryId()!=<span class="literal">null</span>,</span><br><span class="line">            Setmeal::getStatus,</span><br><span class="line">            setmeal.getStatus());</span><br><span class="line">    setmealDtoLambdaQueryWrapper.eq(Setmeal::getStatus,<span class="number">1</span>);</span><br><span class="line">    List&lt;Setmeal&gt; list = setmealService.list(setmealDtoLambdaQueryWrapper);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> R.success(list);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="购物车"><a href="#购物车" class="headerlink" title="购物车"></a>购物车</h3><p>需求分析</p>
<p><img src="/assets/Snipaste_2024-05-05_22-02-44-1715058981805-70.png"></p>
<p>数据分析</p>
<p><img src="/assets/Snipaste_2024-05-05_22-23-51-1715058981806-72.png"></p>
<h4 id="开发代码-梳理流程"><a href="#开发代码-梳理流程" class="headerlink" title="开发代码-梳理流程"></a>开发代码-梳理流程</h4><p>需要梳理一下购物车操作时前端页面和服务端的交互过程：<br>1、点击加入或者●按钮，页面发送ajx请求，请求服务端，将菜品或者套餐添加到购物车<br>2、点击购物车图标，页面发送)jx请求，请求服务端查询购物车中的菜品和套餐<br>3、点击清空购物车按钮，页面发送ajx请求，请求服务端来执行清空购物车操作<br>开发购物车功能，其实就是在服务端编写代码去处理前端页面发送的这3次请求即可。</p>
<p><img src="/assets/Snipaste_2024-05-05_22-48-30-1715058981805-71.png"></p>
<h4 id="重要-添加购物车逻辑"><a href="#重要-添加购物车逻辑" class="headerlink" title="(重要)添加购物车逻辑"></a>(重要)添加购物车逻辑</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">//设置用户id,指定当前哪个用户的购物车</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">//查询当前菜品或者套餐是否在购物车中</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">//如果已存在,number+1</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">//如果不存在,添加到购物车中,默认数量是1</span><br></pre></td></tr></table></figure>



<p>完整代码</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@PostMapping(&quot;/add&quot;)</span></span><br><span class="line"><span class="keyword">public</span> Result&lt;ShoppingCart&gt; <span class="title function_">add</span><span class="params">(<span class="meta">@RequestBody</span> ShoppingCart shoppingCart)</span> &#123;</span><br><span class="line">    log.info(<span class="string">&quot;shoppingCart=&#123;&#125;&quot;</span>, shoppingCart);</span><br><span class="line">    <span class="comment">//获取当前用户id</span></span><br><span class="line">    <span class="type">Long</span> <span class="variable">currentId</span> <span class="operator">=</span> BaseContext.getCurrentId();</span><br><span class="line">    <span class="comment">//设置当前用户id</span></span><br><span class="line">    shoppingCart.setUserId(currentId);</span><br><span class="line">    <span class="comment">//获取当前菜品id</span></span><br><span class="line">    <span class="type">Long</span> <span class="variable">dishId</span> <span class="operator">=</span> shoppingCart.getDishId();</span><br><span class="line">    <span class="comment">//条件构造器</span></span><br><span class="line">    LambdaQueryWrapper&lt;ShoppingCart&gt; queryWrapper = <span class="keyword">new</span> <span class="title class_">LambdaQueryWrapper</span>&lt;&gt;();</span><br><span class="line">    <span class="comment">//判断添加的是菜品还是套餐</span></span><br><span class="line">    <span class="keyword">if</span> (dishId != <span class="literal">null</span>) &#123;</span><br><span class="line">        queryWrapper.eq(ShoppingCart::getDishId, dishId);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        queryWrapper.eq(ShoppingCart::getSetmealId, shoppingCart.getSetmealId());</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//查询当前菜品或者套餐是否在购物车中</span></span><br><span class="line">    <span class="type">ShoppingCart</span> <span class="variable">cartServiceOne</span> <span class="operator">=</span> shoppingCartService.getOne(queryWrapper);</span><br><span class="line">    <span class="keyword">if</span> (cartServiceOne != <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="comment">//如果已存在就在当前的数量上加1</span></span><br><span class="line">        <span class="type">Integer</span> <span class="variable">number</span> <span class="operator">=</span> cartServiceOne.getNumber();</span><br><span class="line">        cartServiceOne.setNumber(number + <span class="number">1</span>);</span><br><span class="line">        shoppingCartService.updateById(cartServiceOne);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">//如果不存在，则还需设置一下创建时间</span></span><br><span class="line">        shoppingCart.setCreateTime(LocalDateTime.now());</span><br><span class="line">        <span class="comment">//如果不存在，则添加到购物车，数量默认为1</span></span><br><span class="line">        shoppingCartService.save(shoppingCart);</span><br><span class="line">        <span class="comment">//这里是为了统一结果，最后都返回cartServiceOne会比较方便</span></span><br><span class="line">        cartServiceOne = shoppingCart;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> Result.success(cartServiceOne);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="减号按钮-删减购车订单数据"><a href="#减号按钮-删减购车订单数据" class="headerlink" title="减号按钮,删减购车订单数据"></a>减号按钮,删减购车订单数据</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@PostMapping(&quot;/sub&quot;)</span></span><br><span class="line"><span class="keyword">public</span> Result&lt;ShoppingCart&gt; <span class="title function_">sub</span><span class="params">(<span class="meta">@RequestBody</span> ShoppingCart shoppingCart)</span> &#123;</span><br><span class="line">    <span class="type">Long</span> <span class="variable">dishId</span> <span class="operator">=</span> shoppingCart.getDishId();</span><br><span class="line">    <span class="type">Long</span> <span class="variable">setmealId</span> <span class="operator">=</span> shoppingCart.getSetmealId();</span><br><span class="line">    <span class="comment">//条件构造器</span></span><br><span class="line">    LambdaQueryWrapper&lt;ShoppingCart&gt; queryWrapper = <span class="keyword">new</span> <span class="title class_">LambdaQueryWrapper</span>&lt;&gt;();</span><br><span class="line">    <span class="comment">//只查询当前用户ID的购物车</span></span><br><span class="line">    queryWrapper.eq(ShoppingCart::getUserId, BaseContext.getCurrentId());</span><br><span class="line">    <span class="comment">//代表数量减少的是菜品数量</span></span><br><span class="line">    <span class="keyword">if</span> (dishId != <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="comment">//通过dishId查出购物车菜品数据</span></span><br><span class="line">        queryWrapper.eq(ShoppingCart::getDishId, dishId);</span><br><span class="line">        <span class="type">ShoppingCart</span> <span class="variable">dishCart</span> <span class="operator">=</span> shoppingCartService.getOne(queryWrapper);</span><br><span class="line">        <span class="comment">//将查出来的数据的数量-1</span></span><br><span class="line">        dishCart.setNumber(dishCart.getNumber() - <span class="number">1</span>);</span><br><span class="line">        <span class="type">Integer</span> <span class="variable">currentNum</span> <span class="operator">=</span> dishCart.getNumber();</span><br><span class="line">        <span class="comment">//然后判断</span></span><br><span class="line">        <span class="keyword">if</span> (currentNum &gt; <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="comment">//大于0则更新</span></span><br><span class="line">            shoppingCartService.updateById(dishCart);</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (currentNum == <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="comment">//小于0则删除</span></span><br><span class="line">            shoppingCartService.removeById(dishCart.getId());</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> Result.success(dishCart);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (setmealId != <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="comment">//通过setmealId查询购物车套餐数据</span></span><br><span class="line">        queryWrapper.eq(ShoppingCart::getSetmealId, setmealId);</span><br><span class="line">        <span class="type">ShoppingCart</span> <span class="variable">setmealCart</span> <span class="operator">=</span> shoppingCartService.getOne(queryWrapper);</span><br><span class="line">        <span class="comment">//将查出来的数据的数量-1</span></span><br><span class="line">        setmealCart.setNumber(setmealCart.getNumber() - <span class="number">1</span>);</span><br><span class="line">        <span class="type">Integer</span> <span class="variable">currentNum</span> <span class="operator">=</span> setmealCart.getNumber();</span><br><span class="line">        <span class="comment">//然后判断</span></span><br><span class="line">        <span class="keyword">if</span> (currentNum &gt; <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="comment">//大于0则更新</span></span><br><span class="line">            shoppingCartService.updateById(setmealCart);</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (currentNum == <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="comment">//等于0则删除</span></span><br><span class="line">            shoppingCartService.removeById(setmealCart.getId());</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> Result.success(setmealCart);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> Result.error(<span class="string">&quot;系统繁忙，请稍后再试&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h4 id="清空购物车"><a href="#清空购物车" class="headerlink" title="清空购物车"></a>清空购物车</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@DeleteMapping(&quot;/clean&quot;)</span></span><br><span class="line"><span class="keyword">public</span> R&lt;String&gt; <span class="title function_">clean</span><span class="params">()</span> &#123;</span><br><span class="line">    LambdaQueryWrapper&lt;ShoppingCart&gt; shoppingCartLambdaQueryWrapper = <span class="keyword">new</span> <span class="title class_">LambdaQueryWrapper</span>&lt;&gt;();</span><br><span class="line">    shoppingCartLambdaQueryWrapper.eq(BaseContext.getCurrentId() != <span class="literal">null</span>, ShoppingCart::getUserId, BaseContext.getCurrentId());</span><br><span class="line">    shoppingCartService.remove(shoppingCartLambdaQueryWrapper);</span><br><span class="line">    <span class="keyword">return</span> R.success(<span class="string">&quot;购车已清空&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="17-用户下单"><a href="#17-用户下单" class="headerlink" title="17.用户下单"></a>17.用户下单</h2><h3 id="前置分析-梳理"><a href="#前置分析-梳理" class="headerlink" title="前置分析,梳理"></a>前置分析,梳理</h3><p>需求分析</p>
<p><img src="/assets/Snipaste_2024-05-06_18-07-41-1715058981806-73.png"></p>
<p>支付功能跳过</p>
<p>数据模型</p>
<p><img src="/assets/Snipaste_2024-05-06_18-09-42-1715058981806-74.png"></p>
<p><img src="/assets/Snipaste_2024-05-06_18-12-19-1715058981806-75.png"></p>
<p>梳理交互过程</p>
<p><img src="/assets/Snipaste_2024-05-06_18-13-11-1715058981806-76.png"></p>
<p><img src="/assets/Snipaste_2024-05-06_18-17-57-1715058981806-77.png"></p>
<h4 id="用什么参数接收"><a href="#用什么参数接收" class="headerlink" title="用什么参数接收"></a>用什么参数接收</h4><p><img src="/assets/Snipaste_2024-05-06_18-46-35-1715058981801-1.png"></p>
<h3 id="梳理逻辑"><a href="#梳理逻辑" class="headerlink" title="梳理逻辑"></a>梳理逻辑</h3><p>1获得当前用户id<br>2查询当前用户的购物车数握<br>3向订单表插入数据，一条数揭<br>4向订单明细表插入数据，多条数据<br>5清空鸭物车数</p>
<h3 id="下单-完整代码"><a href="#下单-完整代码" class="headerlink" title="下单-完整代码"></a>下单-完整代码</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="meta">@Transactional</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">submit</span><span class="params">(Orders orders)</span> &#123;</span><br><span class="line">    <span class="type">Long</span> <span class="variable">userId</span> <span class="operator">=</span> BaseContext.getCurrentId();</span><br><span class="line">    <span class="comment">//构造条件</span></span><br><span class="line">    LambdaQueryWrapper&lt;ShoppingCart&gt; queryWrapper = <span class="keyword">new</span> <span class="title class_">LambdaQueryWrapper</span>&lt;&gt;();</span><br><span class="line">    <span class="comment">//获得指定userId用户,购车数据</span></span><br><span class="line">    queryWrapper.eq(userId!=<span class="literal">null</span>,ShoppingCart::getUserId, userId);</span><br><span class="line">    List&lt;ShoppingCart&gt; shoppingCarts = shoppingCartService.list(queryWrapper);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (shoppingCarts == <span class="literal">null</span> ) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">CustomException</span>(<span class="string">&quot;购物车为空,不能下单&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//查询 用户数据</span></span><br><span class="line">    <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> userService.getById(BaseContext.getCurrentId());</span><br><span class="line"></span><br><span class="line">    <span class="comment">//查询地址数据</span></span><br><span class="line">    <span class="type">Long</span> <span class="variable">addressBookId</span> <span class="operator">=</span> orders.getAddressBookId();</span><br><span class="line">    <span class="type">AddressBook</span> <span class="variable">addressBook</span> <span class="operator">=</span> addressBookService.getById(addressBookId);</span><br><span class="line">    <span class="keyword">if</span> (addressBook == <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">CustomException</span>(<span class="string">&quot;地址不能为空&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//从购物车填充到order中</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">//订单号</span></span><br><span class="line">    <span class="type">Long</span> <span class="variable">orderId</span> <span class="operator">=</span> IdWorker.getId();</span><br><span class="line">    <span class="comment">//1.计算总的金额 2.把明细算出来</span></span><br><span class="line">    <span class="type">AtomicInteger</span> <span class="variable">amount</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">AtomicInteger</span>(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">    List&lt;OrderDetail&gt; orderDetails = shoppingCarts.stream().map((item) -&gt; &#123;</span><br><span class="line">        <span class="type">OrderDetail</span> <span class="variable">orderDetail</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">OrderDetail</span>();</span><br><span class="line">        orderDetail.setOrderId(orderId);</span><br><span class="line">        orderDetail.setName(item.getName());</span><br><span class="line">        orderDetail.setImage(item.getImage());</span><br><span class="line">        orderDetail.setDishId(item.getDishId());</span><br><span class="line">        orderDetail.setSetmealId(item.getSetmealId());</span><br><span class="line">        orderDetail.setDishFlavor(item.getDishFlavor());</span><br><span class="line">        orderDetail.setNumber(item.getNumber());</span><br><span class="line">        orderDetail.setAmount(item.getAmount());</span><br><span class="line">        amount.addAndGet(item.getAmount().multiply(<span class="keyword">new</span> <span class="title class_">BigDecimal</span>(item.getNumber())).intValue());</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> orderDetail;</span><br><span class="line"></span><br><span class="line">    &#125;).collect(Collectors.toList());</span><br><span class="line"></span><br><span class="line">    orders.setId(orderId);</span><br><span class="line">    orders.setNumber(String.valueOf(orderId));</span><br><span class="line">    orders.setStatus(<span class="number">2</span>);</span><br><span class="line">    orders.setUserId(BaseContext.getCurrentId());</span><br><span class="line">    orders.setAddressBookId(addressBookId);</span><br><span class="line">    orders.setOrderTime(LocalDateTime.now());</span><br><span class="line">    orders.setCheckoutTime(LocalDateTime.now());</span><br><span class="line">    orders.setAmount(<span class="keyword">new</span> <span class="title class_">BigDecimal</span>(amount.get()));</span><br><span class="line">    orders.setPhone(addressBook.getPhone());</span><br><span class="line">    orders.setUserName(user.getName());</span><br><span class="line">    orders.setConsignee(addressBook.getConsignee());</span><br><span class="line">    orders.setAddress(</span><br><span class="line">            (addressBook.getProvinceName() == <span class="literal">null</span> ? <span class="string">&quot;&quot;</span>:addressBook.getProvinceName())+</span><br><span class="line">                    (addressBook.getCityName() == <span class="literal">null</span> ? <span class="string">&quot;&quot;</span>:addressBook.getCityName())+</span><br><span class="line">                    (addressBook.getDistrictName() == <span class="literal">null</span> ? <span class="string">&quot;&quot;</span>:addressBook.getDistrictName())+</span><br><span class="line">                    (addressBook.getDetail() == <span class="literal">null</span> ? <span class="string">&quot;&quot;</span>:addressBook.getDetail()));</span><br><span class="line"></span><br><span class="line">    <span class="comment">//往订单表Order中插入数据(一条)</span></span><br><span class="line">    <span class="built_in">this</span>.save(orders);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//往订单明细表中插入数据(可能多条)</span></span><br><span class="line">    orderDetailService.saveBatch(orderDetails);</span><br><span class="line">    <span class="comment">//清空购物车数据</span></span><br><span class="line">    shoppingCartService.remove(queryWrapper);</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="历史订单功能"><a href="#历史订单功能" class="headerlink" title="历史订单功能"></a>历史订单功能</h3><p>请求网址: <a target="_blank" rel="noopener" href="http://localhost/order/userPage?page=1&pageSize=1">http://localhost/order/userPage?page=1&amp;pageSize=1</a><br>请求方法: GET</p>
<p>需要一个OrderDto</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">OrdersDto</span> <span class="keyword">extends</span> <span class="title class_">Orders</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String userName;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String phone;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String address;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String consignee;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> List&lt;OrderDetail&gt; orderDetails;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>下单分页显示-代码</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@GetMapping(&quot;/userPage&quot;)</span></span><br><span class="line"><span class="keyword">public</span> Result&lt;Page&gt; <span class="title function_">page</span><span class="params">(<span class="type">int</span> page, <span class="type">int</span> pageSize)</span> &#123;</span><br><span class="line">    <span class="comment">//获取当前id</span></span><br><span class="line">    <span class="type">Long</span> <span class="variable">userId</span> <span class="operator">=</span> BaseContext.getCurrentId();</span><br><span class="line">    Page&lt;Orders&gt; pageInfo = <span class="keyword">new</span> <span class="title class_">Page</span>&lt;&gt;(page, pageSize);</span><br><span class="line">    Page&lt;OrdersDto&gt; ordersDtoPage = <span class="keyword">new</span> <span class="title class_">Page</span>&lt;&gt;(page, pageSize);</span><br><span class="line">    <span class="comment">//条件构造器</span></span><br><span class="line">    LambdaQueryWrapper&lt;Orders&gt; queryWrapper = <span class="keyword">new</span> <span class="title class_">LambdaQueryWrapper</span>&lt;&gt;();</span><br><span class="line">    <span class="comment">//查询当前用户id订单数据</span></span><br><span class="line">    queryWrapper.eq(userId != <span class="literal">null</span>, Orders::getUserId, userId);</span><br><span class="line">    <span class="comment">//按时间降序排序</span></span><br><span class="line">    queryWrapper.orderByDesc(Orders::getOrderTime);</span><br><span class="line">    orderService.page(pageInfo, queryWrapper);</span><br><span class="line">    List&lt;OrdersDto&gt; list = pageInfo.getRecords().stream().map((item) -&gt; &#123;</span><br><span class="line">        <span class="type">OrdersDto</span> <span class="variable">ordersDto</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">OrdersDto</span>();</span><br><span class="line">        <span class="comment">//获取orderId,然后根据这个id，去orderDetail表中查数据</span></span><br><span class="line">        <span class="type">Long</span> <span class="variable">orderId</span> <span class="operator">=</span> item.getId();</span><br><span class="line">        LambdaQueryWrapper&lt;OrderDetail&gt; wrapper = <span class="keyword">new</span> <span class="title class_">LambdaQueryWrapper</span>&lt;&gt;();</span><br><span class="line">        wrapper.eq(OrderDetail::getOrderId, orderId);</span><br><span class="line">        List&lt;OrderDetail&gt; details = orderDetailService.list(wrapper);</span><br><span class="line">        BeanUtils.copyProperties(item, ordersDto);</span><br><span class="line">        <span class="comment">//之后set一下属性</span></span><br><span class="line">        ordersDto.setOrderDetails(details);</span><br><span class="line">        <span class="keyword">return</span> ordersDto;</span><br><span class="line">    &#125;).collect(Collectors.toList());</span><br><span class="line">    BeanUtils.copyProperties(pageInfo, ordersDtoPage, <span class="string">&quot;records&quot;</span>);</span><br><span class="line">    ordersDtoPage.setRecords(list);</span><br><span class="line">    <span class="comment">//日志输出看一下</span></span><br><span class="line">    log.info(<span class="string">&quot;list:&#123;&#125;&quot;</span>, list);</span><br><span class="line">    <span class="keyword">return</span> Result.success(ordersDtoPage);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta"><i class="fas fa-circle-user fa-fw"></i>Author: </span><span class="post-copyright-info"><a href="http://example.com">John Doe</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta"><i class="fas fa-square-arrow-up-right fa-fw"></i>Link: </span><span class="post-copyright-info"><a href="http://example.com/2024/05/07/%E7%91%9E%E5%90%89%E5%A4%96%E5%8D%96%E7%AC%94%E8%AE%B0/">http://example.com/2024/05/07/%E7%91%9E%E5%90%89%E5%A4%96%E5%8D%96%E7%AC%94%E8%AE%B0/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta"><i class="fas fa-circle-exclamation fa-fw"></i>Copyright Notice: </span><span class="post-copyright-info">All articles in this blog are licensed under <a target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a> unless stating additionally.</span></div></div><div class="tag_share"><div class="post-meta__tag-list"></div><div class="post_share"><div class="social-share" data-image="https://i.loli.net/2021/02/24/5O1day2nriDzjSu.png" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.3/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.3/sharejs/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><div class="next-post pull-full"><a href="/2024/05/07/hello-world/" title="Hello World"><div class="cover" style="background: var(--default-bg-color)"></div><div class="pagination-info"><div class="label">Next</div><div class="next_info">Hello World</div></div></a></div></nav></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src="https://i.loli.net/2021/02/24/5O1day2nriDzjSu.png" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__name">John Doe</div><div class="author-info__description"></div></div><div class="card-info-data site-data is-center"><a href="/archives/"><div class="headline">Articles</div><div class="length-num">2</div></a><a href="/tags/"><div class="headline">Tags</div><div class="length-num">0</div></a><a href="/categories/"><div class="headline">Categories</div><div class="length-num">0</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/xxxxxx"><i class="fab fa-github"></i><span>Follow Me</span></a></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>Announcement</span></div><div class="announcement_content">This is my Blog</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>Contents</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E7%91%9E%E5%90%89%E5%A4%96%E5%8D%96"><span class="toc-number">1.</span> <span class="toc-text">瑞吉外卖</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%85%B3%E4%BA%8EMybatisPlus%E7%9F%A5%E8%AF%86%E7%82%B9-%E9%9C%80%E8%A1%A5%E5%85%85"><span class="toc-number">1.1.</span> <span class="toc-text">关于MybatisPlus知识点(需补充)</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#controller%E5%B1%82%E7%94%A8mp%E7%89%B9%E7%82%B9"><span class="toc-number">1.1.1.</span> <span class="toc-text">controller层用mp特点</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8F%8C%E8%A1%A8%E6%9F%A5%E8%AF%A2"><span class="toc-number">1.1.2.</span> <span class="toc-text">双表查询</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%86%E9%A1%B5%E6%9F%A5%E6%89%BE%E7%89%B9%E7%82%B9"><span class="toc-number">1.1.3.</span> <span class="toc-text">分页查找特点&#x3D;&gt;</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8C%BA%E5%88%86-%E7%94%A8%E4%B8%8D%E7%94%A8-RequestBody-PathVariable"><span class="toc-number">1.1.4.</span> <span class="toc-text">区分 用不用 @RequestBody  @PathVariable</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%86%E9%A1%B5%E4%B8%8D%E6%98%BE%E7%A4%BA%E5%AD%97%E6%AE%B5%E4%BF%AE%E6%94%B9-13-2%E5%A5%97%E9%A4%90%E5%88%86%E7%B1%BB-%E8%8C%83%E4%BE%8B"><span class="toc-number">1.1.5.</span> <span class="toc-text">分页不显示字段修改(13.2套餐分类) 范例</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%88%A0%E9%99%A4-%E6%89%B9%E9%87%8F-%E6%80%BB%E7%BB%93"><span class="toc-number">1.1.5.0.1.</span> <span class="toc-text">删除(批量)总结</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%B5%B7%E5%94%AE%E5%81%9C%E5%94%AE%E6%80%BB%E7%BB%93"><span class="toc-number">1.1.5.0.2.</span> <span class="toc-text">起售停售总结</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#%E9%AA%8C%E8%AF%81%E7%A0%81"><span class="toc-number">1.1.5.0.2.1.</span> <span class="toc-text">验证码</span></a></li></ol></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%8E%B7%E5%8F%96%E7%94%A8%E6%88%B7idapi"><span class="toc-number">1.1.5.1.</span> <span class="toc-text">获取用户idapi</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%8F%82%E6%95%B0%E7%9A%84%E6%8E%A5%E6%94%B6"><span class="toc-number">1.1.5.2.</span> <span class="toc-text">参数的接收</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%8B%E8%AE%A2%E5%8D%95-%E6%A2%B3%E7%90%86%E9%80%BB%E8%BE%91"><span class="toc-number">1.1.6.</span> <span class="toc-text">下订单-梳理逻辑</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#1-%E6%95%B4%E4%BD%93%E4%BB%8B%E7%BB%8D"><span class="toc-number">1.2.</span> <span class="toc-text">1.整体介绍</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-1-%E5%8A%9F%E8%83%BD%E6%9E%B6%E6%9E%84"><span class="toc-number">1.2.1.</span> <span class="toc-text">1.1 功能架构</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-2-%E8%A7%92%E8%89%B2"><span class="toc-number">1.2.2.</span> <span class="toc-text">1.2 角色</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-%E5%BC%80%E5%8F%91%E7%8E%AF%E5%A2%83%E7%9A%84%E6%90%AD%E5%BB%BA"><span class="toc-number">1.3.</span> <span class="toc-text">2.开发环境的搭建</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#2-1-%E6%95%B0%E6%8D%AE%E5%BA%93"><span class="toc-number">1.3.1.</span> <span class="toc-text">2.1 数据库</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-2-maven%E6%90%AD%E5%BB%BA"><span class="toc-number">1.3.2.</span> <span class="toc-text">2.2 maven搭建</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-3-%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6"><span class="toc-number">1.3.3.</span> <span class="toc-text">2.3 配置文件</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-%E5%90%AF%E5%8A%A8%E9%A1%B9"><span class="toc-number">1.4.</span> <span class="toc-text">3 启动项</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#3-1%E5%90%AF%E5%8A%A8%E9%A1%B9"><span class="toc-number">1.4.1.</span> <span class="toc-text">3.1启动项</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-2%E5%AE%9E%E4%BD%93%E7%B1%BB%E5%AF%BC%E5%85%A5"><span class="toc-number">1.4.2.</span> <span class="toc-text">3.2实体类导入</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-3-%E9%80%9A%E7%94%A8%E7%9A%84%E5%BC%80%E5%8F%91%E5%AE%9E%E4%BD%93%E7%B1%BB"><span class="toc-number">1.4.3.</span> <span class="toc-text">3.3 通用的开发实体类</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-4%E6%98%A0%E5%B0%84-%E9%99%8C%E7%94%9F"><span class="toc-number">1.4.4.</span> <span class="toc-text">3.4映射(陌生)</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-%E7%99%BB%E9%99%86%E5%8A%9F%E8%83%BD-%E9%99%8C%E7%94%9F"><span class="toc-number">1.5.</span> <span class="toc-text">4.登陆功能(陌生)</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%80%9D%E8%B7%AF%E5%88%86%E6%9E%90"><span class="toc-number">1.5.1.</span> <span class="toc-text">思路分析</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%BF%87%E6%BB%A4%E5%99%A8-%E4%BB%A3%E7%A0%81%E5%AE%9E%E7%8E%B0-%E9%99%8C%E7%94%9F"><span class="toc-number">1.5.2.</span> <span class="toc-text">过滤器 - - 代码实现(陌生)</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5-%E9%80%80%E5%87%BA%E5%8A%9F%E8%83%BD-%E9%99%8C%E7%94%9F"><span class="toc-number">1.6.</span> <span class="toc-text">5 .退出功能(陌生)</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#6-%E5%AE%8C%E5%96%84%E7%99%BB%E9%99%86%E5%8A%9F%E8%83%BD-%E8%BF%87%E6%BB%A4%E5%99%A8-%E9%99%8C%E7%94%9F"><span class="toc-number">1.7.</span> <span class="toc-text">6. 完善登陆功能-过滤器(陌生)</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#6-1-%E5%85%88%E6%90%AD%E5%BB%BA%E6%9E%B6%E5%AD%90-%E4%BF%9D%E8%AF%81%E8%BF%87%E6%BB%A4%E5%99%A8%E8%83%BD%E7%94%9F%E6%95%88"><span class="toc-number">1.7.1.</span> <span class="toc-text">6.1 先搭建架子-保证过滤器能生效</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-2%E9%80%BB%E8%BE%91%E5%A4%84%E7%90%86-%E9%99%8C%E7%94%9F"><span class="toc-number">1.7.2.</span> <span class="toc-text">6.2逻辑处理(陌生)</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#7-%E6%96%B0%E5%A2%9E%E5%91%98%E5%B7%A5"><span class="toc-number">1.8.</span> <span class="toc-text">7.新增员工</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#7-1%E9%9C%80%E6%B1%82%E5%88%86%E6%9E%90%E5%92%8C%E6%95%B0%E6%8D%AE%E6%A8%A1%E5%9E%8B"><span class="toc-number">1.8.1.</span> <span class="toc-text">7.1需求分析和数据模型</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#7-2%E6%A2%B3%E7%90%86%E6%B5%81%E7%A8%8B"><span class="toc-number">1.8.2.</span> <span class="toc-text">7.2梳理流程*</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#7-3%E4%BB%A3%E7%A0%81%E5%AE%9E%E7%8E%B0"><span class="toc-number">1.8.3.</span> <span class="toc-text">7.3代码实现</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#7-4%E7%BC%96%E5%86%99%E5%85%A8%E5%B1%80%E5%BC%82%E5%B8%B8%E5%A4%84%E7%90%86%E5%99%A8-%E9%87%8D%E5%90%8D%E4%B8%8D%E5%8F%AF%E6%96%B0%E5%A2%9E-%E9%99%8C%E7%94%9F"><span class="toc-number">1.8.4.</span> <span class="toc-text">7.4编写全局异常处理器-重名不可新增(陌生)</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BB%A3%E7%A0%81%E5%AE%9E%E7%8E%B0"><span class="toc-number">1.8.4.1.</span> <span class="toc-text">代码实现</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%89%BE%E9%94%99%E9%94%99%E8%AF%AF%E5%B9%B6%E8%BF%94%E5%9B%9E-%E9%99%8C%E7%94%9F"><span class="toc-number">1.8.4.2.</span> <span class="toc-text">找错错误并返回(陌生)</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%80%BB%E7%BB%93-%E9%87%8D%E7%82%B9%E5%A4%8D%E4%B9%A0"><span class="toc-number">1.8.5.</span> <span class="toc-text">总结 (重点复习)</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#8-%E5%91%98%E5%B7%A5%E4%BF%A1%E6%81%AF%E7%9A%84%E5%88%86%E9%A1%B5%E6%9F%A5%E8%AF%A2"><span class="toc-number">1.9.</span> <span class="toc-text">8.员工信息的分页查询</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#8-1%E9%9C%80%E6%B1%82%E5%88%86%E6%9E%90"><span class="toc-number">1.9.1.</span> <span class="toc-text">8.1需求分析</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#8-2%E8%BF%87%E7%A8%8B%E6%A2%B3%E7%90%86"><span class="toc-number">1.9.2.</span> <span class="toc-text">8.2过程梳理</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#8-3%E4%BB%A3%E7%A0%81%E5%BC%80%E5%8F%91"><span class="toc-number">1.9.3.</span> <span class="toc-text">8.3代码开发</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%88%9B%E5%BB%BAMybatisPlusConfig-%E9%99%8C%E7%94%9F"><span class="toc-number">1.9.3.1.</span> <span class="toc-text">创建MybatisPlusConfig(陌生)</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#9-%E5%90%AF%E7%94%A8-%E7%A6%81%E7%94%A8%E5%91%98%E5%B7%A5"><span class="toc-number">1.10.</span> <span class="toc-text">9.启用&#x2F;禁用员工</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#9-1%E9%9C%80%E6%B1%82%E5%88%86%E6%9E%90"><span class="toc-number">1.10.1.</span> <span class="toc-text">9.1需求分析</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#9-2%E7%BD%91%E9%A1%B5%E4%B8%ADajax%E8%AF%B7%E6%B1%82%E6%98%AF%E5%A6%82%E4%BD%95%E5%8F%91%E9%80%81%E7%9A%84"><span class="toc-number">1.10.2.</span> <span class="toc-text">9.2网页中ajax请求是如何发送的</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#9-3%E4%BB%A3%E7%A0%81%E5%BC%80%E5%8F%91"><span class="toc-number">1.10.3.</span> <span class="toc-text">9.3代码开发</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%B2%BE%E5%BA%A6%E4%B8%A2%E5%A4%B1-%E9%99%8C%E7%94%9F"><span class="toc-number">1.10.3.1.</span> <span class="toc-text">精度丢失(陌生)</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%A6%82%E4%BD%95%E4%BD%BF%E7%94%A8webMVC-%E9%99%8C%E7%94%9F"><span class="toc-number">1.10.3.2.</span> <span class="toc-text">如何使用webMVC(陌生)</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%9C%A8WebMvcConfig%E4%B8%AD%E5%88%9B%E5%BB%BA%E6%B6%88%E6%81%AF%E8%BD%AC%E6%8D%A2%E5%99%A8-%E9%99%8C%E7%94%9F"><span class="toc-number">1.10.3.3.</span> <span class="toc-text">在WebMvcConfig中创建消息转换器(陌生)</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#10-%E7%BC%96%E8%BE%91%E5%91%98%E5%B7%A5%E4%BF%A1%E6%81%AF"><span class="toc-number">1.11.</span> <span class="toc-text">10.编辑员工信息</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#10-1%E9%9C%80%E6%B1%82%E5%88%86%E6%9E%90"><span class="toc-number">1.11.1.</span> <span class="toc-text">10.1需求分析</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#10-2%E4%BB%A3%E7%A0%81%E5%BC%80%E5%8F%91-%E6%A2%B3%E7%90%86%E6%B5%81%E7%A8%8B"><span class="toc-number">1.11.2.</span> <span class="toc-text">10.2代码开发-梳理流程</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#11-%E5%88%86%E7%B1%BB%E7%AE%A1%E7%90%86"><span class="toc-number">1.12.</span> <span class="toc-text">11.分类管理</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#11-1%E5%85%AC%E5%85%B1%E5%AD%97%E6%AE%B5%E8%87%AA%E5%8A%A8%E5%A1%AB%E5%85%85-%E5%BF%85%E4%BC%9A"><span class="toc-number">1.12.1.</span> <span class="toc-text">11.1公共字段自动填充(必会)</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%97%AE%E9%A2%98%E5%88%86%E6%9E%90"><span class="toc-number">1.12.1.1.</span> <span class="toc-text">问题分析</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BB%A3%E7%A0%81%E5%AE%9E%E7%8E%B0-1"><span class="toc-number">1.12.1.2.</span> <span class="toc-text">代码实现</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%8A%9F%E8%83%BD%E5%AE%8C%E5%96%84"><span class="toc-number">1.12.1.3.</span> <span class="toc-text">功能完善</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BB%80%E4%B9%88%E6%98%AFThreadLocal"><span class="toc-number">1.12.1.4.</span> <span class="toc-text">什么是ThreadLocal</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BB%A3%E7%A0%81%E5%AE%9E%E7%8E%B0-2"><span class="toc-number">1.12.1.5.</span> <span class="toc-text">代码实现</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#1-BaseContext%E5%B7%A5%E5%85%B7%E7%B1%BB-%E9%99%8C%E7%94%9F"><span class="toc-number">1.12.1.5.1.</span> <span class="toc-text">1.BaseContext工具类(陌生)</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#2-%E5%9C%A8LoginCheckFilter%E4%B8%AD%E6%B7%BB%E5%8A%A0"><span class="toc-number">1.12.1.5.2.</span> <span class="toc-text">2.在LoginCheckFilter中添加</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#3-%E5%9C%A8MyMetaObjectHandler-BaseContext-getCurrentId-%E7%94%A8%E6%96%B9%E6%B3%95%E6%9B%BF%E6%8D%A2%E5%9B%BA%E5%AE%9A%E5%80%BC"><span class="toc-number">1.12.1.5.3.</span> <span class="toc-text">3.在MyMetaObjectHandler&#x3D;&gt;BaseContext.getCurrentId()用方法替换固定值</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#11-2%E6%96%B0%E5%A2%9E%E5%88%86%E7%B1%BB"><span class="toc-number">1.12.2.</span> <span class="toc-text">11.2新增分类</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%9C%80%E6%B1%82%E5%88%86%E6%9E%90"><span class="toc-number">1.12.2.1.</span> <span class="toc-text">需求分析</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%BC%80%E5%8F%91%E4%B8%9A%E5%8A%A1%E5%8A%9F"><span class="toc-number">1.12.2.2.</span> <span class="toc-text">开发业务功</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#11-3-%E5%88%A0%E9%99%A4%E5%88%86%E7%B1%BB"><span class="toc-number">1.12.3.</span> <span class="toc-text">11.3.删除分类</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%9C%80%E6%B1%82%E5%88%86%E6%9E%90-1"><span class="toc-number">1.12.3.1.</span> <span class="toc-text">需求分析</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BB%A3%E7%A0%81%E5%BC%80%E5%8F%91"><span class="toc-number">1.12.3.2.</span> <span class="toc-text">代码开发</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%8A%9F%E8%83%BD%E5%AE%8C%E5%96%84-%E9%99%8C%E7%94%9F"><span class="toc-number">1.12.3.3.</span> <span class="toc-text">功能完善(陌生)</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#11-4%E4%BF%AE%E6%94%B9%E5%88%86%E7%B1%BB"><span class="toc-number">1.12.4.</span> <span class="toc-text">11.4修改分类</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#12-%E8%8F%9C%E5%93%81%E7%AE%A1%E7%90%86"><span class="toc-number">1.13.</span> <span class="toc-text">12.菜品管理</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#12-1%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E4%B8%8B%E8%BD%BD-%E9%99%8C%E7%94%9F"><span class="toc-number">1.13.0.1.</span> <span class="toc-text">12.1文件上传下载(陌生)</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#%E4%B8%8A%E4%BC%A0"><span class="toc-number">1.13.0.1.0.1.</span> <span class="toc-text">上传</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E4%B8%8B%E8%BD%BD"><span class="toc-number">1.13.0.1.0.2.</span> <span class="toc-text">下载</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E4%B8%8A%E4%BC%A0-%E4%BB%A3%E7%A0%81%E5%AE%9E%E7%8E%B0"><span class="toc-number">1.13.0.1.0.3.</span> <span class="toc-text">上传 代码实现</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E4%B8%8B%E8%BD%BD%E4%BB%A3%E7%A0%81%E5%AE%9E%E7%8E%B0"><span class="toc-number">1.13.0.1.0.4.</span> <span class="toc-text">下载代码实现</span></a></li></ol></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#12-2%E6%96%B0%E5%A2%9E%E8%8F%9C%E5%93%81"><span class="toc-number">1.13.0.2.</span> <span class="toc-text">12.2新增菜品</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E9%9C%80%E6%B1%82%E5%88%86%E6%9E%90-2"><span class="toc-number">1.13.0.2.1.</span> <span class="toc-text">需求分析</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E4%BB%A3%E7%A0%81%E5%BC%80%E5%8F%91-%E6%A2%B3%E7%90%86"><span class="toc-number">1.13.0.2.2.</span> <span class="toc-text">代码开发-梳理</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#4-%E9%87%8D%E7%82%B9-%E5%8F%8C%E8%A1%A8%E8%81%94%E6%9F%A5-DTO"><span class="toc-number">1.13.0.2.3.</span> <span class="toc-text">*4.(重点)双表联查&#x3D;&gt;DTO</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#12-3-%E8%8F%9C%E5%93%81%E4%BF%A1%E6%81%AF%E5%88%86%E9%A1%B5%E6%9F%A5%E8%AF%A2"><span class="toc-number">1.13.0.3.</span> <span class="toc-text">12.3 菜品信息分页查询</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%87%8D%E7%82%B9-%E4%B8%8D%E6%98%BE%E7%A4%BA%E5%AD%97%E6%AE%B5%E4%BF%AE%E6%94%B9"><span class="toc-number">1.13.0.4.</span> <span class="toc-text">(重点)不显示字段修改</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#12-4%E4%BF%AE%E6%94%B9%E8%8F%9C%E5%93%81"><span class="toc-number">1.13.0.5.</span> <span class="toc-text">12.4修改菜品</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#12-5%E6%89%B9%E9%87%8F%E5%88%A0%E9%99%A4-%E7%BB%86%E8%8A%82%E7%9C%8B%E4%B8%8B"><span class="toc-number">1.13.0.6.</span> <span class="toc-text">12.5批量删除(细节看下)</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#12-6%E6%89%B9%E9%87%8F%E8%B5%B7%E5%94%AE%E5%81%9C%E5%94%AE-%E7%9C%8B%E4%B8%8B"><span class="toc-number">1.13.0.7.</span> <span class="toc-text">12.6批量起售停售(看下)</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#13-%E5%A5%97%E9%A4%90%E7%AE%A1%E7%90%86"><span class="toc-number">1.14.</span> <span class="toc-text">13.套餐管理</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#13-1%E6%96%B0%E5%A2%9E%E5%A5%97%E9%A4%90"><span class="toc-number">1.14.1.</span> <span class="toc-text">13.1新增套餐</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%B7%BB%E5%8A%A0%E8%8F%9C%E5%93%81%E7%AA%97%E5%8F%A3%E4%B8%AD"><span class="toc-number">1.14.1.1.</span> <span class="toc-text">添加菜品窗口中</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#13-2%E5%A5%97%E9%A4%90%E4%BF%A1%E6%81%AF%E5%88%86%E9%A1%B5%E6%9F%A5%E8%AF%A2"><span class="toc-number">1.14.2.</span> <span class="toc-text">13.2套餐信息分页查询</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E9%87%8D%E7%82%B9-%E5%A5%97%E9%A4%90%E5%88%86%E7%B1%BB%E4%B8%8D%E6%98%BE%E7%A4%BA"><span class="toc-number">1.14.2.0.1.</span> <span class="toc-text">(重点)套餐分类不显示</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#13-3%E5%88%A0%E9%99%A4%E5%A5%97%E9%A4%90"><span class="toc-number">1.14.3.</span> <span class="toc-text">13.3删除套餐</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#14-%E6%89%8B%E6%9C%BA%E9%AA%8C%E8%AF%81%E7%99%BB%E9%99%86"><span class="toc-number">1.15.</span> <span class="toc-text">14.手机验证登陆</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#14-1%E7%9F%AD%E4%BF%A1%E5%8F%91%E9%80%81"><span class="toc-number">1.15.1.</span> <span class="toc-text">14.1短信发送</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%9F%AD%E4%BF%A1%E6%9C%8D%E5%8A%A1%E4%BB%8B%E7%BB%8D"><span class="toc-number">1.15.1.1.</span> <span class="toc-text">短信服务介绍</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%98%BF%E9%87%8C%E4%BA%91%E7%9F%AD%E4%BF%A1%E6%9C%8D%E5%8A%A1"><span class="toc-number">1.15.1.2.</span> <span class="toc-text">阿里云短信服务</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BB%A3%E7%A0%81%E5%BC%80%E5%8F%91-1"><span class="toc-number">1.15.1.3.</span> <span class="toc-text">代码开发</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#14-2%E6%89%8B%E6%9C%BA%E9%AA%8C%E8%AF%81%E7%A0%81%E7%99%BB%E9%99%86"><span class="toc-number">1.15.2.</span> <span class="toc-text">14.2手机验证码登陆</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E9%92%88%E5%AF%B9%E7%A7%BB%E5%8A%A8%E7%AB%AF%E7%94%A8%E6%88%B7-%E6%8B%A6%E6%88%AA%E5%99%A8"><span class="toc-number">1.15.2.0.1.</span> <span class="toc-text">针对移动端用户-拦截器</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#HttpSession"><span class="toc-number">1.15.2.0.1.1.</span> <span class="toc-text">HttpSession</span></a></li></ol></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%89%8B%E6%9C%BA%E9%AA%8C%E8%AF%81%E7%99%BB%E9%99%86"><span class="toc-number">1.15.2.1.</span> <span class="toc-text">手机验证登陆</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#15-%E7%94%A8%E6%88%B7%E7%99%BB%E9%99%86"><span class="toc-number">1.16.</span> <span class="toc-text">15.用户登陆</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%99%BB%E9%99%86%E4%BB%A3%E7%A0%81-%E9%99%8C%E7%94%9F"><span class="toc-number">1.16.1.</span> <span class="toc-text">登陆代码(陌生)</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#16-%E6%89%8B%E6%9C%BA%E7%AB%AF-%E8%8F%9C%E5%93%81%E5%B1%95%E7%A4%BA"><span class="toc-number">1.17.</span> <span class="toc-text">16.手机端 菜品展示</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AF%BC%E5%85%A5%E7%94%A8%E6%88%B7%E5%9C%B0%E5%9D%80%E7%B0%BF%E7%9B%B8%E5%85%B3%E5%8A%9F%E8%83%BD%E4%BB%A3%E7%A0%81%E3%80%82"><span class="toc-number">1.17.1.</span> <span class="toc-text">导入用户地址簿相关功能代码。</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%96%B0%E5%A2%9E%E5%9C%B0%E5%9D%80-%E9%99%8C%E7%94%9F"><span class="toc-number">1.17.1.1.</span> <span class="toc-text">新增地址(陌生)</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%AE%BE%E7%BD%AE%E9%BB%98%E8%AE%A4%E5%9C%B0%E5%9D%80"><span class="toc-number">1.17.1.2.</span> <span class="toc-text">设置默认地址</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%A0%B9%E6%8D%AEid%E6%9F%A5%E8%AF%A2%E5%9C%B0%E5%9D%80"><span class="toc-number">1.17.1.3.</span> <span class="toc-text">根据id查询地址</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%9F%A5%E8%AF%A2%E9%BB%98%E8%AE%A4%E5%9C%B0%E5%9D%80"><span class="toc-number">1.17.1.4.</span> <span class="toc-text">查询默认地址</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%9F%A5%E8%AF%A2%E6%8C%87%E5%AE%9A%E7%94%A8%E6%88%B7%E7%9A%84%E5%85%A8%E9%83%A8%E5%9C%B0%E5%9D%80"><span class="toc-number">1.17.1.5.</span> <span class="toc-text">查询指定用户的全部地址</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%8F%9C%E5%93%81%E5%B1%95%E7%A4%BA"><span class="toc-number">1.17.2.</span> <span class="toc-text">菜品展示</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1%E9%A1%B5%E9%9D%A2%E5%8A%A0%E8%BD%BD%E8%8E%B7%E5%8F%96%E5%88%86%E7%B1%BB%E6%95%B0%E6%8D%AE"><span class="toc-number">1.17.2.1.</span> <span class="toc-text">1页面加载获取分类数据</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%94%B9%E9%80%A0dish-Dto"><span class="toc-number">1.17.2.1.1.</span> <span class="toc-text">改造dish Dto</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%A5%97%E9%A4%90%E5%BC%80%E5%8F%91-%E5%9B%9E%E6%98%BE"><span class="toc-number">1.17.2.2.</span> <span class="toc-text">套餐开发-回显</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%B4%AD%E7%89%A9%E8%BD%A6"><span class="toc-number">1.17.3.</span> <span class="toc-text">购物车</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%BC%80%E5%8F%91%E4%BB%A3%E7%A0%81-%E6%A2%B3%E7%90%86%E6%B5%81%E7%A8%8B"><span class="toc-number">1.17.3.1.</span> <span class="toc-text">开发代码-梳理流程</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%87%8D%E8%A6%81-%E6%B7%BB%E5%8A%A0%E8%B4%AD%E7%89%A9%E8%BD%A6%E9%80%BB%E8%BE%91"><span class="toc-number">1.17.3.2.</span> <span class="toc-text">(重要)添加购物车逻辑</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%87%8F%E5%8F%B7%E6%8C%89%E9%92%AE-%E5%88%A0%E5%87%8F%E8%B4%AD%E8%BD%A6%E8%AE%A2%E5%8D%95%E6%95%B0%E6%8D%AE"><span class="toc-number">1.17.3.3.</span> <span class="toc-text">减号按钮,删减购车订单数据</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%B8%85%E7%A9%BA%E8%B4%AD%E7%89%A9%E8%BD%A6"><span class="toc-number">1.17.3.4.</span> <span class="toc-text">清空购物车</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#17-%E7%94%A8%E6%88%B7%E4%B8%8B%E5%8D%95"><span class="toc-number">1.18.</span> <span class="toc-text">17.用户下单</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%89%8D%E7%BD%AE%E5%88%86%E6%9E%90-%E6%A2%B3%E7%90%86"><span class="toc-number">1.18.1.</span> <span class="toc-text">前置分析,梳理</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%94%A8%E4%BB%80%E4%B9%88%E5%8F%82%E6%95%B0%E6%8E%A5%E6%94%B6"><span class="toc-number">1.18.1.1.</span> <span class="toc-text">用什么参数接收</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%A2%B3%E7%90%86%E9%80%BB%E8%BE%91"><span class="toc-number">1.18.2.</span> <span class="toc-text">梳理逻辑</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%8B%E5%8D%95-%E5%AE%8C%E6%95%B4%E4%BB%A3%E7%A0%81"><span class="toc-number">1.18.3.</span> <span class="toc-text">下单-完整代码</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8E%86%E5%8F%B2%E8%AE%A2%E5%8D%95%E5%8A%9F%E8%83%BD"><span class="toc-number">1.18.4.</span> <span class="toc-text">历史订单功能</span></a></li></ol></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>Recent Post</span></div><div class="aside-list"><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2024/05/07/%E7%91%9E%E5%90%89%E5%A4%96%E5%8D%96%E7%AC%94%E8%AE%B0/" title="瑞吉外卖笔记">瑞吉外卖笔记</a><time datetime="2024-05-07T05:15:16.000Z" title="Created 2024-05-07 14:15:16">2024-05-07</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2024/05/07/hello-world/" title="Hello World">Hello World</a><time datetime="2024-05-07T02:55:28.750Z" title="Created 2024-05-07 11:55:28">2024-05-07</time></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div class="copyright">&copy;2020 - 2024 By John Doe</div><div class="framework-info"><span>Framework </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>Theme </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="Read Mode"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="Toggle Between Light And Dark Mode"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="Toggle between Single-column and Double-column"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="Setting"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="Table Of Contents"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="Back To Top"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js?v=4.13.0"></script><script src="/js/main.js?v=4.13.0"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui@5.0.33/dist/fancybox/fancybox.umd.min.js"></script><div class="js-pjax"></div><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></body></html>